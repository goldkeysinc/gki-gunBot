var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.owns=function(a,d){return Object.prototype.hasOwnProperty.call(a,d)};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,e){if(e.get||e.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[d]=e.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,d,e,f){if(d){e=$jscomp.global;a=a.split(".");for(f=0;f<a.length-1;f++){var g=a[f];g in e||(e[g]={});e=e[g]}a=a[a.length-1];f=e[a];d=d(f);d!=f&&null!=d&&$jscomp.defineProperty(e,a,{configurable:!0,writable:!0,value:d})}};$jscomp.polyfill("Object.assign",function(a){return a?a:function(a,e){for(var d=1;d<arguments.length;d++){var g=arguments[d];if(g)for(var k in g)$jscomp.owns(g,k)&&(a[k]=g[k])}return a}},"es6-impl","es3");
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var d=0;return $jscomp.iteratorPrototype(function(){return d<a.length?{done:!1,value:a[d++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,d){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var e=0,f={next:function(){if(e<a.length){var g=e++;return{value:d(g,a[g]),done:!1}}f.next=function(){return{done:!0,value:void 0}};return f.next()}};f[Symbol.iterator]=function(){return f};return f};
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");$jscomp.findInternal=function(a,d,e){a instanceof String&&(a=String(a));for(var f=a.length,g=0;g<f;g++){var k=a[g];if(d.call(e,k,g,a))return{i:g,v:k}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,e){return $jscomp.findInternal(this,a,e).v}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,e){return e})}},"es6","es3");var chartUpdateInterval=setInterval(function(){if(gridInitialized&&window_focus)for(b in panelSettings=$.jStorage.get("panelSettings"),chartPeriods=$.jStorage.get("chartPeriods"),bots)bot=bots[b],1==panelSettings[bot.key]&&getCandleChartData(bot.index,chartPeriods[bot.key])},6E4),gettingData={};
function updateCandleChart(a,d){if(gridInitialized&&(bot=bots[a],panelSettings=$.jStorage.get("panelSettings"),chartPeriods=$.jStorage.get("chartPeriods"),"undefined"!=typeof bot.chartData&&"undefined"!=typeof bot.chartData[chartPeriods[bot.key]]&&("undefined"==typeof d&&(d=bot.chartData[chartPeriods[bot.key]]),1==panelSettings[bot.key])))if(chartCell=$("#table-"+a+"-chart-cell-0"),-1!=["bittrex","cryptopia"].indexOf(bots[a].exchange.toLowerCase())&&10>d.length)animateChartCell=function(a){a.attr("is-empty",
"true").empty();a.html('\x3cdiv\x3e\x3ch3 style\x3d"height:250px; line-height:250px; text-align:center; color:#1e1e1e;"\x3eNot enough trades to show chart\x3ch3\x3e\x3c/div\x3e');a.fadeIn(animationPeriod)},0<chartCell.html().length&&"true"!=chartCell.attr("is-empty")?(chartCell.fadeOut(animationPeriod),setTimeout(animateChartCell,301,chartCell)):animateChartCell(chartCell);else{"true"==$("#table-"+a+"-chart-cell-0").attr("is-empty")&&($("#table-"+a+"-chart-cell-0").attr("is-empty","false"),$("#table-"+
a+"-chart-cell-0").empty());if(10<d.length){period=$.jStorage.get("chartPeriods")[bot.key];targets=bots[a].targets;"kraken"==bot.exchange&&(period*=60);bollingerAlgorithm=fc.indicatorBollingerBands().value(function(a){return a.close});bollingerData=bollingerAlgorithm(d);mergedData=d.map(function(a,d){return Object.assign({},a,{bollinger:bollingerData[d]})});"undefined"!=typeof tradeHistory[bot.key]&&getSetting("chartShowTrades",bots[a].key)&&(tradeHistoryAggregated=tradeHistory[bot.key].reduce(function(a,
d){timeKey=Math.floor((new Date(d.date)/1E3+("bittrex"==bot.exchange?0:-60*(new Date).getTimezoneOffset()))/period)*period;"undefined"==typeof a[timeKey]&&(a[timeKey]={buy:[],sell:[]});a[timeKey][d.type].push(d.price);return a},{}),tradeHistoryAggregated=Object.keys(tradeHistoryAggregated).reduce(function(a,d){trades=tradeHistoryAggregated[d];mapTrades=[];["buy","sell"].forEach(function(a){1==trades[a].length?mapTrades.push({price:trades[a][0],type:a}):0<trades[a].length&&(min=Math.min.apply(null,
trades[a]),max=Math.max.apply(null,trades[a]),.01>(max-min)/max?mapTrades.push({price:"buy"==a?min:max,type:a}):(mapTrades.push({price:min,type:a}),mapTrades.push({price:max,type:a})))});a[d]=mapTrades;return a},{}),mergedData=mergedData.reduce(function(a,d){timeKey=d.date/1E3;"undefined"!=typeof tradeHistoryAggregated[timeKey]?tradeHistoryAggregated[timeKey].forEach(function(e,f){newDataPoint=JSON.parse(JSON.stringify(d));newDataPoint.date=new Date(newDataPoint.date);newDataPoint.trade=e;a.push(newDataPoint)}):
a.push(d);return a},[]));mergedData=mergedData.map(function(a){"undefined"!=typeof targets&&0<targets.minPriceToSell&&(a.minPriceToSell=targets.minPriceToSell);"undefined"!=typeof targets&&0<targets.maxPriceToBuy&&(a.maxPriceToBuy=targets.maxPriceToBuy);return a});padding=.0075*(mergedData[mergedData.length-1].date-mergedData[0].date);$("#table-"+a+"-chart-cell-0").width();d=fc.extentDate().accessors([function(a){return a.date}]).padUnit("domain").pad([padding,padding]);var e=fc.extentLinear().accessors([function(a){return Math.max(a.bollinger.upper,
a.high)},function(a){return Math.min(a.bollinger.lower,a.low)}]);tickPeriod=-1!=["bittrex","cryptopia"].indexOf(bot.exchange)?1E3*+period:mergedData[1].date-mergedData[0].date;ticks=(mergedData[mergedData.length-1].date-mergedData[0].date)/tickPeriod;barWidth=Math.max(1,Math.min(10,$("#table-"+a+"-chart-cell-0").width()/ticks/2));candlestick=fc.seriesSvgCandlestick().barWidth(barWidth);tradeSeries=getSetting("chartShowTrades",bots[a].key)?fc.seriesSvgPoint().crossValue(function(a){return a.date}).mainValue(function(a){return"undefined"==
typeof a.trade?void 0:a.trade.price}).size(50>mergedData.length?250:100>mergedData.length?150:60).decorate(function(a){a.select("path").style("stroke",function(a){return"white"}).style("fill",function(a){if("sell"==a.trade.type)return"rgba(249, 7, 7, 0.8)";if("buy"==a.trade.type)return"rgba(0, 214, 46, 0.8)"})}):fc.seriesSvgPoint();sellTargetLine="undefined"!=typeof targets&&getSetting("chartShowTargets",bots[a].key)&&0<targets.minPriceToSell?fc.seriesSvgLine().crossValue(function(a,d){return a.date}).mainValue(function(a,
d){return a.minPriceToSell}).decorate(function(a){a.attr("stroke",function(a,d){return"red"}).attr("stroke-width",function(a,d){return 1}).attr("stroke-dasharray",function(a,d){return"5, 3"})}):fc.seriesSvgLine();buyTargetLine="undefined"!=typeof targets&&getSetting("chartShowTargets",bots[a].key)&&0<targets.maxPriceToBuy?fc.seriesSvgLine().crossValue(function(a,d){return a.date}).mainValue(function(a,d){return a.maxPriceToBuy}).decorate(function(a){a.attr("stroke",function(a,d){return"green"}).attr("stroke-width",
function(a,d){return 1}).attr("stroke-dasharray",function(a,d){return"5, 3"})}):fc.seriesSvgLine();var f=fc.seriesSvgMulti().series([function(){var d=fc.seriesSvgArea().mainValue(function(a){return a.bollinger.upper}).baseValue(function(a){return a.bollinger.lower}),e=fc.seriesSvgLine().mainValue(function(a){return a.bollinger.upper}),f=fc.seriesSvgLine().mainValue(function(a){return a.bollinger.average}),l=fc.seriesSvgLine().mainValue(function(a){return a.bollinger.lower}),h=function(a){return a.date};
d.crossValue(h);e.crossValue(h);f.crossValue(h);l.crossValue(h);d=fc.seriesSvgMulti().series([d,e,l,f]).decorate(function(a,d,e){a.enter().attr("class",function(a,d){return"multi bollinger "+["area","upper","lower","average"][d]})});return getSetting("chartBollinger",bots[a].key)?d:fc.seriesSvgMulti().series([])}(),sellTargetLine,buyTargetLine,candlestick,tradeSeries]);d=fc.chartSvgCartesian(fc.scaleDiscontinuous(d3.scaleTime()),d3.scaleLinear()).yDomain(e(mergedData)).xDomain(d(mergedData)).plotArea(f).yTickFormat(d3.format("."+
fixedDecimals(Math.min.apply(null,mergedData.map(function(a){return a.low})))+"f"));$.jStorage.get("gridAnimations")?d3.select("#table-"+a+"-chart-cell-0").datum(mergedData).transition().duration(animationPeriod).call(d):d3.select("#table-"+a+"-chart-cell-0").datum(mergedData).call(d);$(".chart-label").remove();$(".x-axis-label").remove()}bots[a].lastChartUpdate=+Date.now()}}gettingData={};
function getCandleChartData(a,d){bot=bots[a];if("undefined"==typeof bot.gettingData||!bot.gettingData){start=Math.round(Date.now()/1E3-604800);switch(parseInt(d)){case 300:start=Math.round(Date.now()/1E3-64800);break;case 900:start=Math.round(Date.now()/1E3-129600);break;case 1800:start=Math.round(Date.now()/1E3-259200);break;case 7200:start=Math.round(Date.now()/1E3-1296E3);break;case 14400:start=Math.round(Date.now()/1E3-2592E3);break;case 86400:start=Math.round(Date.now()/1E3-11664E3)}(function(e,
f,g){"poloniex"==e.exchange?(bots[a].gettingData=!0,$.ajax({url:"https://poloniex.com/public",data:{command:"returnChartData",currencyPair:e.pair,start:f,end:9999999999,period:g},error:function(a,d,f){console.log(a.status);console.log(f);bots[e.index].gettingData=!1},success:function(a){a=a.map(function(a){return{date:new Date(1E3*a.date),open:+a.open,high:+a.high,low:+a.low,close:+a.close,volume:+a.volume}});chartPeriods=$.jStorage.get("chartPeriods");chartPeriods[e.key]=d;$.jStorage.set("chartPeriods",
chartPeriods);"undefined"==typeof e.chartData&&(e.chartData={});e.chartData[d]=a;e.gettingData=!1;bots[e.index]=e;updateCandleChart(e.index,a)}})):["kraken","bittrex","cryptopia"].indexOf(e.exchange.toLowerCase())&&(bots[a].gettingData=!0,socket.emit("chartData",{index:e.index,period:g}))})(bot,start,d)}}
function updateProfitChart(a,d){data=bots[a].profits;if("undefined"!=typeof data&&"undefined"!=typeof data[d]&&"undefined"!=typeof data[d].balances)if(profitIntervals=$.jStorage.get("profitIntervals",{}),profitIntervals[bots[a].key]=d,$.jStorage.set("profitIntervals",profitIntervals),chartCell=$("#table-"+a+"-profit-cell-0"),"undefined"==typeof data||0==Object.keys(data[d].balances).length)animateChartCell=function(a){a.attr("is-empty","true").empty();a.html('\x3cdiv\x3e\x3ch3 style\x3d"height:250px; line-height:250px; text-align:center; color:#1e1e1e;"\x3eNo trades found in selected time period\x3ch3\x3e\x3c/div\x3e');
a.fadeIn(animationPeriod)},0<chartCell.html().length&&"true"!=chartCell.attr("is-empty")?(chartCell.fadeOut(animationPeriod),setTimeout(animateChartCell,301,chartCell)):animateChartCell(chartCell);else{"true"==$("#table-"+a+"-profit-cell-0").attr("is-empty")&&($("#table-"+a+"-profit-cell-0").attr("is-empty","false"),$("#table-"+a+"-profit-cell-0").empty());ticks=Math.ceil((Date.now()/1E3-data[d].start)/data[d].tickPeriod);profits=[];for(t=0;t<ticks;t++)date=data[d].start+t*data[d].tickPeriod,currencyBalance=
"undefined"==typeof data[d].balances[date]?0==profits.length?0:profits[profits.length-1].currencyBalance:data[d].balances[date].currencyBalance,altCurrencyBalance="undefined"==typeof data[d].balances[date]?0==profits.length?0:profits[profits.length-1].altCurrencyBalance:data[d].balances[date].altCurrencyBalance,profits.push({date:1E3*date,currencyBalance:currencyBalance,altCurrencyBalance:altCurrencyBalance});padding=.0175*(profits[profits.length-1].date-profits[0].date);d=fc.extentLinear().accessors([function(a){return a.currencyBalance}]);
var e=fc.extentLinear().accessors([function(a){return a.date}]).pad([padding,padding]).padUnit("domain");d=fc.chartSvgCartesian(fc.scaleDiscontinuous(d3.scaleTime()),d3.scaleLinear()).yDomain(d(profits)).xDomain(e(profits));e=fc.seriesSvgBar().crossValue(function(a){return a.date}).mainValue(function(a){return a.currencyBalance}).decorate(function(a){a.select("path").style("stroke",function(a){if(.000001<a.altCurrencyBalance)return.000001<a.currencyBalance?"green":"red";if(.000001<a.currencyBalance)return"green"}).style("fill",
function(a){return.000001<a.altCurrencyBalance?"black":.000001<a.currencyBalance?"green":"red"})});e=fc.seriesSvgMulti().series([e]);d.yTickFormat(d3.format(".8f"));d.plotArea(e);chartObject=$.jStorage.get("gridAnimations")?d3.select("#table-"+a+"-profit-cell-0").datum(profits).transition().duration(animationPeriod).call(d):d3.select("#table-"+a+"-profit-cell-0").datum(profits).call(d);$(".chart-label").remove();$(".x-axis-label").remove()}}var socket,socketTimeout;
function connectToSocket(a){socket=io.connect("//"+window.location.hostname+":"+window.location.port,{reconnection:!1,reconnectionDelay:1E3,reconnectionDelayMax:5E3,reconnectionAttempts:5,secure:"https"==window.location.protocol});socketTimeout=setTimeout(function(){$("#errorSocketBody").html("Socket server seems unreachable, trying to connect for just a bit longer ... ");$("#errorSocketRefresh").attr("disabled","disabled");$("#errorSocketModal").modal("show")},1500);socket.on("connect",function(){restartRequired=
!1;$("#errorSocketModal").modal("hide");$("#restartRequiredModal").modal("hide");socket.emit("authentication",a);socket.on("authenticated",function(a,e){clearTimeout(socketTimeout);authRequired=!1;$("#pwd").val("");$("#2fa-token").val("");$("#pwd-button").prop("disabled",!1);$("#login").fadeOut(0)});socket.on("authRequired",function(a,e){clearTimeout(socketTimeout);e.password&&$.jStorage.deleteKey("authHash");if(e.whitelist)socketError("","Client refused, it's IP address was not found in whitelist"),
authRequired=!0,stopClient();else{authRequired=!0;twoFactorEnabled=a.twoFactor;$("#pwd-label").css("display",a.password?"":"none");$("#pwd").css("display",a.password?"":"none");$("#2fa-label").css("display",a.twoFactor?"":"none");$("#2fa-token").css("display",a.twoFactor?"":"none");$("#pwd-button").css("margin-top",a.password&&a.twoFactor?"20px":"0px");$("#pwd-label").css({color:e.password?"#ED4528":"#bcbcbc"}).html(e.password?"Invalid password!":"Password:");$("#2fa-label").css({color:e.twoFactor?
"#ED4528":"#bcbcbc"}).html(e.twoFactor?"Invalid two-factor token!":"Two-factor token:");$("#pwd-button").off();if(a.password)$("#pwd-button").on("click",function(a){$(this).attr("disabled",!0);connectToSocket({password:$("#pwd").val(),twoFactorToken:$("#2fa-token").val()},!1)});else $("#pwd-button").on("click",function(a){$(this).attr("disabled",!0);connectToSocket({password:$.jStorage.get("authHash"),twoFactorToken:$("#2fa-token").val()},!1)});$("#login").fadeIn(animationPeriod)}});socket.on("hashedPassword",
function(a){$.jStorage.set("authHash",a)});socket.on("connect_timeout",function(){socketError("Timeout","The socket server reached a timeout!")});socket.on("connect_error",function(a){socketError(a)});socket.on("doGetBots",function(){getBots(!0)});socket.on("editBotConfig",function(a,e){onEditBotConfig(a,e)});socket.on("guiConfig",function(a,e){onGuiConfig(a,e)});socket.on("botConfigs",function(a){onBotConfigs(a)});socket.on("createdBotConfigs",function(a){socket.emit("requestNewBot")});socket.on("bots",
function(a,e){onBots(a,e)});socket.on("log",function(a,e){onLogs(a,e)});socket.on("guiLogs",function(a){onGuiLogs(a)});socket.on("newVersion",function(a,e){onNewVersion(a,e)});socket.on("ticker",function(a,e){onExchangeTicker(a,e)});socket.on("requestNewBot",function(a){onRequestNewBot(a)});socket.on("chartData",function(a,e,f){onChartData(a,e,f)});socket.on("tradeHistory",function(a,e){onTradeHistory(a,e)});socket.on("openOrders",function(a,e,f){onOpenOrders(a,e,f)});socket.on("request2FA",function(a){onRequest2FA(a)});
socket.on("verify2FA",function(a){onVerify2FA(a)});socket.on("gunbotStrategies",function(a){onGunbotStrategies(a)});socket.on("gunbotConfig",function(a){ongunbotConfig(a)});socket.on("ipAddress",function(a){$("#edit-config-ipWhitelist-ipAddress").val(a);$("#edit-config-ipWhitelist-add").attr("disabled",!1)});socket.on("sslConfig",function(a,e,f){onSslConfig(a,e,f)});socket.on("sysInfo",function(a){onSysInfo(a)});socket.on("totalBalances",function(a){onTotalBalances(a)});socket.on("gunbotStatus",function(a){a||
(currentLogIndex=-1);$("#gunbotSvgGreen").fadeOut(animationPeriod/2);$("#gunbotSvgRed").fadeOut(animationPeriod/2);setGunbotButton(a)});socket.on("guiCrash",function(a){errorStack=a;$(".modal").modal("hide");$("#errorSocketBody").empty();$("#errorSocketBody").append("\x3cdiv\x3eThe GUI has crashed due to an unexpected error:\x3c/div\x3e");0<errorStack.length&&$("#errorSocketBody").append('\x3cdiv style\x3d"color:red; font-weight:bold;"\x3e'+errorStack[0]+"\x3c/div\x3e");1<errorStack.length&&(errorStackDiv=
$('\x3cdiv style\x3d"color:red; font-size:10px;"\x3e\x3c/div\x3e').appendTo($("#errorSocketBody")).fadeOut(0),errorStack.splice(1).forEach(function(a){errorStackDiv.append("\x3cdiv\x3e"+a+"\x3c/div\x3e")}),errorStackButton=$('\x3cbutton class\x3d"btn btn-xs btn-danger"\x3eShow error stack\x3c/button\x3e').appendTo($("#errorSocketBody")).off().on("click",{div:errorStackDiv},function(a){$(this).fadeOut(0);$(a.data.div).fadeIn(0)}));$("#errorSocketRefresh").removeAttr("disabled");$("#errorSocketModal").modal("show")});
socket.on("generateCertificate",function(a){if(success=!1===a)$("#configureSslUploadLabel").css({color:"black"}).html("File upload"),$("#configureSslUploadKey").removeClass("btn-danger").removeClass("btn-success").addClass("btn-basic"),$("#configureSslUploadCert").removeClass("btn-danger").removeClass("btn-success").addClass("btn-basic");$("#configureSslGenerateLabel").css({color:success?"black":"red"}).html(success?"Generate certificate":a);$("#configureSslGenerateCert").attr("disabled",!1).removeClass("btn-basic").removeClass(success?
"btn-danger":"btn-success").addClass(success?"btn-success":"btn-danger");$("#configureSslTypeSelfSigned").prop("checked",success);$("#configureSslSave").attr("disabled",!$("input[name\x3dconfigureSslCertificate]").is(":checked"))});socket.on("maxChartPeriod",function(a,e){onMaxChartPeriod(a,e)});socket.on("completeBalances",function(a,e,f){null===e&&onCompleteBalances(a,f)});socket.on("profits",function(a,e){onProfits(a,e)});socket.on("disconnect",function(){$("#pwd-button").prop("disabled",!1);stopClient();
restartRequired?$("#restartRequiredModal").modal("show"):socketError(!1,"Disconnected from the socket server")})})}function stopClient(){clearTimeout(socketTimeout);clearInterval(chartUpdateInterval);$("#wrapper").fadeOut(animationPeriod)}$(document).ready(function(){initializeStorage();initializePage();connectToSocket(null===$.jStorage.get("authHash")?null:{password:$.jStorage.get("authHash"),twoFactorToken:null})});
var poloniexTickerConnection=new autobahn.Connection({url:"wss://api.poloniex.com",realm:"realm1"});poloniexTickerConnection.onopen=function(a){a.subscribe("ticker",function(a,e){ev={currencyPair:a[0],last:a[1],lowestAsk:a[2],highestBid:a[3],percentChange:a[4],baseVolume:a[5],quoteVolume:a[6],isFrozen:a[7],"24hrHigh":a[8],"24hrLow":a[9]};gridInitialized&&onPoloniexTickerEvent(a[0],ev)})};poloniexTickerConnection.onerror=function(a){console.log("error poloniex ticker")};poloniexTickerConnection.open();
logInterval=setInterval(function(){bots.filter(function(a){return 0<a.logQueue.length}).forEach(function(a){parseLogs(a.index,[a.logQueue.shift()],!0)})},50);
var gridProfitIntervals=["1y","1m","24h"],gridProfitIntervalLabels={"1y":"Year","1q":"Quarter","1m":"Month","1w":"Week","24h":"24h"},strategyLabels={"core3.2":"Core 3.2"},chartDataPeriods={poloniex:[300,900,1800,7200,14400,86400],kraken:[15,60,240,1440,10080,21600],bittrex:[300,900,1800,3600,14400,86400],cryptopia:[300,900,1800,3600,14400,86400]},chartDataPeriodDefaults={poloniex:900,kraken:15,bittrex:"auto",cryptopia:"auto"},chartDataPeriodLabels={poloniex:{300:"5 min",900:"15 min",1800:"30 min",
7200:"2 hours",14400:"4 hours",86400:"1 day"},kraken:{15:"15 min",60:"1 hour",240:"4 hours",1440:"1 day",10080:"1 week",21600:"15 days"},bittrex:{300:"5 min",900:"15 min",1800:"30 min",3600:"1 hour",14400:"4 hours",86400:"1 day"},cryptopia:{300:"5 min",900:"15 min",1800:"30 min",3600:"1 hour",14400:"4 hours",86400:"1 day"}},gridPanels=["log","chart","profit"],gridSettings={};
initGrid=function(){doInit=function(){if(0==bots.length)socket.emit("requestNewBot");else{panelSettings=$.jStorage.get("panelSettings");wrapper=$("#page-content-wrapper").empty();$("#wrapper").fadeOut(0);noCells=bots.length;for(index=0;index<noCells;index++)bot=bots[index],itemDiv=$('\x3cdiv id\x3d"grid-item-index-'+index+'" class\x3d"main-grid-item muuri-item muuri-item-shown main-col smooth-transition" data-index\x3d"'+index+'" data-move-icon\x3d"move-icon-'+index+'"\x3e').appendTo(wrapper),col=
$('\x3cdiv class\x3d"main-grid-item-content" id\x3d"bot-'+index+'"\x3e').appendTo(itemDiv),"undefined"!=typeof bot&&(col.addClass("main-col"),createToolbar(col,index),createBot(col,index),createChart(col,index),createProfit(col,index),createOptions(index),panelIndex=panelSettings[bot.key],-1<panelIndex&&$("#panel-button-"+index+"-"+panelIndex).addClass("active"),setTimeout(function(a,d){updatePanel(void 0,a,d);updatePanelContent(a,d)},animationPeriod+10,index,panelIndex),updateBalances(index));gridInitialized=
!0;bots.forEach(function(a){updateProfits(a.index);updateTicker(a.index)});$(window).off("resize").resize(function(){"undefined"!=typeof resizeTimer&&clearTimeout(resizeTimer);resizeTimer=setTimeout(function(){resizeGridItems();setTimeout(function(){mainGrid.refreshItems().layout();setTimeout(function(){bots.forEach(function(a){1==$.jStorage.get("panelSettings")[a.key]&&"undefined"!=typeof a.chartData&&"undefined"!=typeof a.chartData[chartPeriods[a.key]]?updateCandleChart(a.index,a.chartData[$.jStorage.get("chartPeriods")[a.key]]):
2==$.jStorage.get("panelSettings")[a.key]&&"undefined"!=typeof a.profits&&updateProfitChart(a.index,$.jStorage.get("profitIntervals")[a.key])})},450)},450)},450)});resizeGridItems(!1);$("#gridSearchInput").off().on("keyup",function(){mainGrid.filter(filterMainGrid)});$("#gridSearchClear").off().on("click",function(a){$(this).parent().find("input").val("");mainGrid.filter(filterMainGrid)});$("#wrapper").fadeIn(animationPeriod);mainGrid=(new Muuri(".main-grid-column-content",{showDuration:animationPeriod,
hideDuration:animationPeriod,layoutDuration:animationPeriod,dragReleaseDuration:animationPeriod,items:sortMainGrid(!1),dragEnabled:!isTouchDevice(),dragStartPredicate:function(a,d){if(2<=d.distance&&$(document.elementFromPoint(d.center.x,d.center.y)).hasClass($(a.getElement()).attr("data-move-icon")))return!0},dragPredicate:function(a,d,e){this.isResolved||("mouse"===a.pointerType?(this.isResolved=!0,e(a)):300<=a.deltaTime&&(this.isResolved=!0,e(a)))},layout:{fillGaps:!1,horizontal:!1,alignRight:!1,
alignBottom:!1}})).on("dragStart",function(a){++dragCounter;docElem.classList.add("dragging");$(a.getElement()).animate({opacity:.8},animationPeriod);$(document.body).css({"overflow-x":"hidden"})}).on("dragEnd",function(a){1>--dragCounter&&docElem.classList.remove("dragging");$(a.getElement()).animate({opacity:1},animationPeriod)}).on("dragReleaseEnd",function(a){$(document.body).css({"overflow-x":"auto"});$.jStorage.set("mainGridOrdering",mainGrid.getItems().map(function(a){return bots[$(a.getElement()).attr("data-index")].key}));
$.jStorage.set("sortGridType","custom");mainGrid.refreshItems()}).filter(filterMainGrid);muuriInstances.push(mainGrid);$(".main-grid-item").css({"user-select":"","touch-action":"auto","-webkit-user-drag":""});isTouchDevice()&&$(".main-grid-move-icon").css({display:"none"})}};initializeStorage();gridInitialized?(gridInitialized=!1,$("#wrapper").fadeOut(animationPeriod),setTimeout(doInit,animationPeriod+1)):(socket.emit("getGunbotStatus"),doInit(),initializeSortGrid(),initializeGridOptions())};
function initializeSortGrid(){items=$.jStorage.get("sortGridOrdering").map(function(a){return $(".sort-grid-item").get().filter(function(d){return $(d).attr("sort-type")==a})[0]});sortGrid=(new Muuri(".sort-grid-column-content",{items:items,dragEnabled:!0,dragStartPredicate:function(a,d){if(2<=d.distance&&$(document.elementFromPoint(d.center.x,d.center.y)).hasClass("move-icon-"+$(a.getElement()).attr("sort-type")))return!0},dragPredicate:function(a,d,e){this.isResolved||("mouse"===a.pointerType?(this.isResolved=
!0,e(a)):300<=a.deltaTime&&(this.isResolved=!0,e(a)))}})).on("dragStart",function(a){++dragCounter;docElem.classList.add("dragging");$(a.getElement()).css({"font-weight":"bold"}).animate({opacity:.8},animationPeriod)}).on("dragEnd",function(a){1>--dragCounter&&docElem.classList.remove("dragging");$(a.getElement()).css({"font-weight":"normal"}).animate({opacity:1},animationPeriod);$.jStorage.set("sortGridOrdering",sortGrid.getItems().map(function(a){return $(a.getElement()).attr("sort-type")}));sortGrid.refreshItems();
$.jStorage.set("sortGridType","auto")}).on("dragReleaseEnd",function(a){sortGrid.refreshItems();mainGrid.sort(sortMainGrid(!0))});muuriInstances.push(sortGrid);$(".sort-filter").off().on("click",function(){state=+$(this).attr("data-state");state++;2==state&&(state=-1);$(this).attr("data-state",state);$(this).removeClass("glyphicon-remove-circle").removeClass("glyphicon-record").removeClass("glyphicon-ok-circle");switch(state){case -1:$(this).addClass("glyphicon-remove-circle").attr("data-state",state);
$(this).parent().css({color:"maroon"});break;case 0:$(this).addClass("glyphicon-record").attr("data-state",state);$(this).parent().css({color:""});break;case 1:$(this).addClass("glyphicon-ok-circle").attr("data-state",state),$(this).parent().css({color:"green"})}$.jStorage.set("sortGridType","auto");$.jStorage.set("sortGridFilter",$(".sort-filter").get().reduce(function(a,d){a[$(d).parent().attr("sort-type")]=+$(d).attr("data-state");return a},{}));mainGrid.sort(sortMainGrid(!0)).filter(filterMainGrid)}).get().forEach(function(a){state=
$.jStorage.get("sortGridFilter")[$(a).parent().attr("sort-type")];$(a).removeClass("glyphicon-remove-circle").removeClass("glyphicon-record").removeClass("glyphicon-ok-circle").attr("data-state",state);switch(state){case -1:$(a).addClass("glyphicon-remove-circle");$(a).parent().css({color:"maroon"});break;case 0:$(a).addClass("glyphicon-record");$(a).parent().css({color:""});break;case 1:$(a).addClass("glyphicon-ok-circle"),$(a).parent().css({color:"green"})}});$(".sort-asc-dec").off().on("click",
function(){ascending=$(this).hasClass("glyphicon-chevron-down");$(this).removeClass(ascending?"glyphicon-chevron-down":"glyphicon-chevron-up").addClass(ascending?"glyphicon-chevron-up":"glyphicon-chevron-down");$.jStorage.set("sortGridType","auto");$.jStorage.set("sortGridAscDesc",$(".sort-asc-dec").get().reduce(function(a,d){a[$(d).parent().attr("sort-type")]=$(d).hasClass("glyphicon-chevron-down");return a},{}));mainGrid.sort(sortMainGrid(!0))}).get().forEach(function(a){ascDesc=$.jStorage.get("sortGridAscDesc")[$(a).parent().attr("sort-type")];
$(a).removeClass("glyphicon-chevron-down").removeClass("glyphicon-chevron-up").addClass(ascDesc?"glyphicon-chevron-down":"glyphicon-chevron-up")})}
function initializeStorage(){!1===$.jStorage.get("sortGridOrdering",!1)&&$.jStorage.set("sortGridOrdering",$(".sort-grid-item").get().map(function(a){return $(a).attr("sort-type")}));!1===$.jStorage.get("sortGridType",!1)&&$.jStorage.set("sortGridType","auto");!1===$.jStorage.get("sortGridFilter",!1)&&$.jStorage.set("sortGridFilter",$(".sort-filter").get().reduce(function(a,d){sortType=$(d).parent().attr("sort-type");a[sortType]=0;return a},{}));!1===$.jStorage.get("sortGridAscDesc",!1)&&$.jStorage.set("sortGridAscDesc",
$(".sort-asc-dec").get().reduce(function(a,d){sortType=$(d).parent().attr("sort-type");a[sortType]=-1!=["enabled","recenttrade"].indexOf(sortType)?!1:!0;return a},{}));!1===$.jStorage.get("gridItemSize",!1)&&$.jStorage.set("gridItemSize","s");"empty"===$.jStorage.get("gridAnimations","empty")&&$.jStorage.set("gridAnimations",!0);"empty"===$.jStorage.get("gridColoredLogs","empty")&&$.jStorage.set("gridColoredLogs",!0);panelSettings=$.jStorage.get("panelSettings",{});chartPeriods=$.jStorage.get("chartPeriods",
{});chartBollinger=$.jStorage.get("chartBollinger",{});chartShowTrades=$.jStorage.get("chartShowTrades",{});chartShowTargets=$.jStorage.get("chartShowTargets",{});profitIntervals=$.jStorage.get("profitIntervals",{});bots.forEach(function(a){key=a.key;"undefined"==typeof panelSettings[key]&&(panelSettings[key]=a.enabled?0:-1);"undefined"==typeof chartPeriods[key]&&(chartPeriods[key]=chartDataPeriodDefaults[a.exchange]);"undefined"==typeof chartBollinger[key]&&(chartBollinger[key]=!0);"undefined"==
typeof chartShowTrades[key]&&(chartShowTrades[key]=!0);"undefined"==typeof chartShowTargets[key]&&(chartShowTargets[key]=!0);"undefined"==typeof profitIntervals[key]&&(profitIntervals[key]="1m")});gridSettings.panelSettings=panelSettings;gridSettings.chartPeriods=chartPeriods;gridSettings.chartBollinger=chartBollinger;gridSettings.chartShowTrades=chartShowTrades;gridSettings.chartShowTargets=chartShowTargets;gridSettings.profitIntervals=profitIntervals;$.jStorage.set("panelSettings",panelSettings);
$.jStorage.set("chartPeriods",chartPeriods);$.jStorage.set("chartBollinger",chartBollinger);$.jStorage.set("chartShowTrades",chartShowTrades);$.jStorage.set("chartShowTargets",chartShowTargets);$.jStorage.set("profitIntervals",profitIntervals)}
function initializePage(){progress(0,$("#cpuBar"));progress(0,$("#memoryBar"));$("#gunbotConfigButton").on("click",function(a){$(this).blur();socket.emit("getGunbotConfig")});$("#gunbotStrategiesButton").on("click",function(a){$(this).blur();socket.emit("getGunbotStrategies")});$("#gridOptionsAnimations").prop("checked",$.jStorage.get("gridAnimations")).on("change",function(a){$.jStorage.set("gridAnimations",$(this).is(":checked"));toggleGridAnimations()});$("#gridOptionsColoredLogs").prop("checked",
$.jStorage.get("gridColoredLogs")).on("change",function(a){$.jStorage.set("gridColoredLogs",$(this).is(":checked"))});toggleGridAnimations()}
function setGunbotButton(a){setTimeout(function(a){a?($("#gunbotSvgGreen").fadeIn(animationPeriod/2),$("#gunbotSvgRed").fadeOut(0),$("#gunbotSvgContainer").attr("title","Gunbot enabled").attr("alt","Gunbot enabled")):($("#gunbotSvgRed").fadeIn(animationPeriod/2),$("#gunbotSvgGreen").fadeOut(0),$("#gunbotSvgContainer").attr("title","Gunbot disabled").attr("alt","Gunbot disabled"),$.jStorage.get("gridAnimations")?$("#gunbotSvgRedCircle").addClass("red-pulse"):$("#gunbotSvgRedCircle").removeClass("red-pulse"));
$("#gunbotLoading").fadeOut(animationPeriod/2)},animationPeriod/2+10,a)}function toggleGridAnimations(){$.jStorage.get("gridAnimations")?($("#gunbotSvgGreenCircle").addClass("green-pulse"),$("#gunbotSvgRedCircle").addClass("red-pulse"),$(".modal").removeClass("fade").addClass("fade")):($("#gunbotSvgGreenCircle").removeClass("green-pulse"),$("#gunbotSvgRedCircle").removeClass("red-pulse"),$(".modal").removeClass("fade"));animationPeriod=$.jStorage.get("gridAnimations")?300:0}
function createToolbar(a,d){toolbar=getDivTable(d+"-toolbar",1,6);toolbar.addClass("toolbar");toolbar.appendTo(a);bot=bots[d];$("#table-"+d+"-toolbar-cell-1").attr("data-index",d).hover(function(){$(this).css("cursor","pointer")},function(){$(this).css("cursor","auto")}).on("click",function(a){updateBalancesModal($(this).attr("data-index"),!0)});$('\x3cdiv class\x3d"divTableHeader"\x3eBalances\x3c/div\x3e').appendTo("#table-"+d+"-toolbar-cell-1");$('\x3cdiv class\x3d"divTableHeader"\x3eTargets \x26 Error\x3c/div\x3e').appendTo("#table-"+
d+"-toolbar-cell-2");$('\x3cdiv class\x3d"divTableHeader"\x3eProfit / Loss\x3c/div\x3e').appendTo("#table-"+d+"-toolbar-cell-3");$('\x3cdiv class\x3d"divTableHeader"\x3eTicker\x3c/div\x3e').appendTo("#table-"+d+"-toolbar-cell-4");$('\x3cdiv class\x3d"divTableHeader"\x3eOptions\x3c/div\x3e').css({color:"#afafaf"}).appendTo("#table-"+d+"-toolbar-cell-5");for(z=0;5>=z;z++)$("#table-"+d+"-toolbar-cell-"+z).addClass("toolbar-cell");cell0=$("#table-"+d+"-toolbar-cell-0").addClass(["toolbar-cell","smooth-transition"]).css({color:"#afafaf",
"min-width":"55px","font-size":"11px","max-width":"55px","text-align":"center"});$("\x3cdiv\x3e"+bot.exchange.charAt(0).toUpperCase()+bot.exchange.slice(1)+"\x3c/div\x3e").appendTo(cell0);$("\x3cdiv\x3e"+bot.pairs[0]+"\x3cbr/\x3e"+bot.pairs[1]+"\x3c/div\x3e").attr("data-index",d).css({"font-size":"15px","line-height":"14px","font-weight":"bold"}).hover(function(){$(this).css("cursor","pointer")},function(){$(this).css("cursor","auto")}).on("click",function(a){bot=bots[$(this).attr("data-index")];
switch(bot.exchange){case "poloniex":url="https://poloniex.com/exchange#"+bot.pair.toLowerCase();break;case "bittrex":url="https://bittrex.com/Market/Index?MarketName\x3d"+bot.pair;break;case "kraken":url="https://www.kraken.com/charts";break;case "cryptopia":url="https://www.cryptopia.co.nz/Exchange?market\x3d"+bot.pair.replace("/","_")}window.open(url)}).appendTo(cell0);$('\x3cdiv\x3e\x3cspan style\x3d"font-size:16px; cursor:move;" class\x3d"glyphicon glyphicon-move main-grid-move-icon move-icon-'+
d+'"\x3e\x3c/span\x3e\x3c/div\x3e').appendTo(cell0);$("#table-"+d+"-toolbar-cell-5").css({color:"#afafaf",width:"90px","border-right":"0px solid black"});getDivTable(d+"-balances",3,2,"\x3cb\x3eAvail.:\x3c/b\x3e;-;\x3cb\x3eOrders:\x3c/b\x3e;-;\x3cb\x3ein BTC:\x3c/b\x3e;-".split(";")).addClass("toolbar-cell-table").appendTo($("#table-"+d+"-toolbar-cell-1"));getDivTable(d+"-gunbot",3,3,"\x3cb\x3eBuy:\x3c/b\x3e -  \x3cb\x3eSell:\x3c/b\x3e -  \x3cb\x3eError:\x3c/b\x3e -".split(" ")).addClass("toolbar-cell-table").appendTo($("#table-"+
d+"-toolbar-cell-2"));getDivTable(d+"-profit-loss",3,2,["\x3cb\x3e"+gridProfitIntervalLabels[gridProfitIntervals[0]]+":\x3c/b\x3e","-","\x3cb\x3e"+gridProfitIntervalLabels[gridProfitIntervals[1]]+":\x3c/b\x3e","-","\x3cb\x3e"+gridProfitIntervalLabels[gridProfitIntervals[2]]+":\x3c/b\x3e","-"]).addClass("toolbar-cell-table").appendTo($("#table-"+d+"-toolbar-cell-3"));getDivTable(d+"-ticker",3,2,"\x3cb\x3eLast:\x3c/b\x3e - \x3cb\x3eHigh:\x3c/b\x3e - \x3cb\x3eLow:\x3c/b\x3e -".split(" ")).addClass("toolbar-cell-table").appendTo($("#table-"+
d+"-toolbar-cell-4"));getDivTable(d+"-options",2,1,[]).css({"text-align":"center",margin:"auto",color:"#afafaf",width:"80px"}).appendTo($("#table-"+d+"-toolbar-cell-5"));$("#table-"+d+"-gunbot-cell-1").css("text-align","right");$("#table-"+d+"-gunbot-cell-2").css("text-align","right");$("#table-"+d+"-gunbot-cell-4").css("text-align","right");$("#table-"+d+"-gunbot-cell-5").css("text-align","right");$("#table-"+d+"-gunbot-cell-7").css("text-align","right");$("#table-"+d+"-gunbot-cell-8").css("text-align",
"right")}
function createBot(a,d){bot=bots[d];botLogContainer=$('\x3cdiv style\x3d"position:relative;" \x3e\x3c/div\x3e').appendTo(a);botLog=$('\x3cdiv class\x3d"bot-tab bot-tab-'+d+' bot-log" id\x3d"bot-log-'+d+'" style\x3d"overflow-x: auto; white-space:nowrap;"\x3e').appendTo(botLogContainer);botLogSettings=$('\x3cdiv alt\x3d"Hold shift to change all" title\x3d"Hold shift to change all" class\x3d"bot-log-settings" id\x3d"bot-log-settings-index-'+d+'" style\x3d"position: absolute; top: 2px; right: 2px; color: rgb(175, 175, 175); text-align:right; height: 25px; width:100px; border-radius: 0px 0px 0px 10px; padding:3px; padding-right:15px;"\x3e\x3c/div\x3e').appendTo(botLogContainer);botLogSettings.append($('\x3clabel for\x3d"bot-setting-pause-index-'+
d+'"\x3ePause log\x26nbsp;\x3c/label\x3e'));pauseLogs=$('\x3cinput id\x3d"bot-setting-pause-index-'+d+'" type\x3d"checkbox"\x3e');pauseLogs.on("click",{index:d},function(a){checked=$(this).is(":checked");a.shiftKey?bots.forEach(function(d){d.index!=a.data.index&&(checkBox=$("#bot-setting-pause-index-"+d.index),checkBox.prop("checked",checked));pausedLogs[d.key]=checked}):pausedLogs[bots[a.data.index].key]=checked}).appendTo(botLogSettings);0!=panelSettings[bot.key]&&(botLog.fadeOut(0),botLogSettings.fadeOut(0));
botLog.append($('\x3cdiv id\x3d"no-bot-logs-'+d+'"\x3e\x3ch3 style\x3d"position:absolute; bottom:0px; left:0px; line-height:350px; text-align:center; width:100%; color:#1e1e1e;"\x3eNo logs received for this bot\x3ch3\x3e\x3c/div\x3e'))}
function createChart(a,d){botChart=$('\x3cdiv class\x3d"bot-tab bot-tab-'+d+'" id\x3d"bot-chart-'+d+'"\x3e\x3c/div\x3e').appendTo(a);bot=bots[d];key=bot.key;1!=panelSettings[key]&&botChart.fadeOut(0);chartTable=getDivTable(d+"-chart",1,2,[]).addClass("bot-chart").appendTo(botChart);$("#table-"+d+"-chart-cell-0").css({height:"325px"});$("#table-"+d+"-chart-cell-1").css({width:"100px","text-align":"right","vertical-align":"middle",color:"black"});bollingerDiv=$('\x3cdiv style\x3d"color:rgb(175, 175, 175); " class\x3d"form-group" alt\x3d"Hold shift to change all" title\x3d"Hold shift to change all"\x3e\x3c/div\x3e').appendTo($("#table-"+
d+"-chart-cell-1"));$('\x3clabel for\x3d"bb-checkbox-'+d+'" style\x3d"margin:0px;"\x3eB. Bands\x3c/label\x3e').appendTo(bollingerDiv);bollingerButton=$('\x3cinput type\x3d"checkbox" class\x3d"bb-checkbox" style\x3d"margin:0px; margin-left:3px;" data-index\x3d'+d+' id\x3d"bb-checkbox-'+d+'"'+(getSetting("chartBollinger",bot.key)?" checked":"")+"\x3e").appendTo(bollingerDiv);bollingerButton.on("click",function(a){checked=$(this).is(":checked");doUpdate=function(a,d){a.prop("checked",d);_index=a.attr("data-index");
_bot=bots[_index];setSetting("chartBollinger",_bot.key,d);updateCandleChart(_index,_bot.chartData[getSetting("chartPeriods",_bot.key)])};a.shiftKey?$(".bb-checkbox").each(function(){doUpdate($(this),checked)}):doUpdate($(this),checked)});showTradesDiv=$('\x3cdiv style\x3d"color:rgb(175, 175, 175);" class\x3d"form-group" alt\x3d"Hold shift to change all" title\x3d"Hold shift to change all"\x3e\x3c/div\x3e').appendTo($("#table-"+d+"-chart-cell-1"));$('\x3clabel for\x3d"trades-checkbox-'+d+'" style\x3d"margin:0px;"\x3eTrades\x3c/label\x3e').appendTo(showTradesDiv);
showTradesButton=$('\x3cinput type\x3d"checkbox" class\x3d"trades-checkbox" style\x3d"margin:0px; margin-left:3px;" data-index\x3d'+d+' id\x3d"trades-checkbox-'+d+'"'+(getSetting("chartShowTrades",bot.key)?" checked":"")+"\x3e").appendTo(showTradesDiv);showTradesButton.on("click",function(a){checked=$(this).is(":checked");doUpdate=function(a,d){a.prop("checked",d);_index=a.attr("data-index");_bot=bots[_index];setSetting("chartShowTrades",_bot.key,d);updateCandleChart(_index,_bot.chartData[getSetting("chartPeriods",
_bot.key)])};a.shiftKey?$(".trades-checkbox").each(function(){doUpdate($(this),checked)}):doUpdate($(this),checked)});showTargetsDiv=$('\x3cdiv style\x3d"color:rgb(175, 175, 175); margin-bottom: 20px;" class\x3d"form-group" alt\x3d"Hold shift to change all" title\x3d"Hold shift to change all"\x3e\x3c/div\x3e').appendTo($("#table-"+d+"-chart-cell-1"));$('\x3clabel for\x3d"targets-checkbox-'+d+'" style\x3d"margin:0px;"\x3eTargets\x3c/label\x3e').appendTo(showTargetsDiv);showTargetsButton=$('\x3cinput type\x3d"checkbox" class\x3d"targets-checkbox" style\x3d"margin:0px; margin-left:3px;" data-index\x3d'+
d+' id\x3d"targets-checkbox-'+d+'"'+(getSetting("chartShowTargets",bot.key)?" checked":"")+"\x3e").appendTo(showTargetsDiv);showTargetsButton.on("click",function(a){checked=$(this).is(":checked");doUpdate=function(a,d){a.prop("checked",d);_index=a.attr("data-index");_bot=bots[_index];setSetting("chartShowTargets",_bot.key,d);updateCandleChart(_index,_bot.chartData[getSetting("chartPeriods",_bot.key)])};a.shiftKey?$(".targets-checkbox").each(function(){doUpdate($(this),checked)}):doUpdate($(this),
checked)});chartDataPeriods[bot.exchange].forEach(function(a){label=chartDataPeriodLabels[bot.exchange][a];button=$('\x3cbutton type\x3d"button" style\x3d"width: 50px; margin-bottom: 12px;" data-index\x3d'+d+' data-period\x3d"'+a+'" class\x3d"'+(chartPeriods[key]==a?"btn-primary":"btn-secondary")+" btn-chart-index-"+d+" btn btn-xs btn-chart-period-"+bot.exchange+"-"+a+" btn-chart-index-period-"+d+"-"+a+'" alt\x3d"Hold shift to change all" title\x3d"Hold shift to change all"\x3e'+label+"\x3c/button\x3e\x3cbr/\x3e").appendTo($("#table-"+
d+"-chart-cell-1"));button.on("click",function(e){e.shiftKey?(_period=$(this).attr("data-period"),_index=$(this).attr("data-index"),bots.filter(function(a){return a.exchange==bots[_index].exchange}).forEach(function(a){$(".btn-chart-index-"+a.index).addClass("btn-secondary").removeClass("btn-primary").attr("aria-pressed",!1);$(".btn-chart-period-"+bots[_index].exchange+"-"+_period).removeClass("btn-secondary").addClass("btn-primary").attr("aria-pressed",!0);getCandleChartData(a.index,_period)})):
(d=$(this).attr("data-index"),a=$(this).attr("data-period"),bot=bots[d],$(".btn-chart-index-"+d).addClass("btn-secondary").removeClass("btn-primary").attr("aria-pressed",!1),$(this).addClass("btn-primary").removeClass("btn-secondary").attr("aria-pressed",!0),getCandleChartData(d,a))})})}
function createProfit(a,d){botProfit=$('\x3cdiv class\x3d"bot-tab bot-tab-'+d+' bot-profit" id\x3d"bot-profit-'+d+'"\x3e\x3c/div\x3e').appendTo(a);bot=bots[d];key=bot.key;2!=panelSettings[key]&&botProfit.fadeOut(0);profitTable=getDivTable(d+"-profit",1,2,[]).addClass("bot-chart").appendTo(botProfit);chartCell=$("#table-"+d+"-profit-cell-0");chartCell.css({height:"325px"});chartCell.attr("is-empty","true");chartCell.html('\x3cdiv\x3e\x3ch3 style\x3d"height:250px; line-height:250px; text-align:center; width:100%; color:#1e1e1e;"\x3eNo trade history received yet ...\x3ch3\x3e\x3c/div\x3e');
$("#table-"+d+"-profit-cell-1").css({width:"90px","text-align":"right","vertical-align":"middle",color:"black"}).fadeOut(0);for(profitInterval in gridProfitIntervalLabels)profitIntervalLabel=gridProfitIntervalLabels[profitInterval],button=$('\x3cbutton type\x3d"button" id\x3d"btn-profit-'+d+"-"+profitInterval+'" style\x3d"width: 50px;" data-index\x3d"'+d+'" data-interval\x3d"'+profitInterval+'" class\x3d"'+(profitIntervals[key]==profitInterval?"btn-primary":"btn-secondary")+" btn-profit-index-"+d+
" btn btn-xs btn-profit-interval-"+profitInterval+'"\x3e'+profitIntervalLabel+"\x3c/button\x3e\x3cbr/\x3e\x26nbsp;\x3cbr/\x3e").appendTo($("#table-"+d+"-profit-cell-1")),button.on("click",function(a){interval=$(this).attr("data-interval");if(a.shiftKey)for(b in bots)bot=bots[b],d=bot.index,$(".btn-profit-index-"+d).addClass("btn-secondary").removeClass("btn-primary").attr("aria-pressed",!1),$("#btn-profit-"+d+"-"+interval).addClass("btn-primary").removeClass("btn-secondary").attr("aria-pressed",!0),
updateProfitChart(d,interval);else d=$(this).attr("data-index"),$(".btn-profit-index-"+d).addClass("btn-secondary").removeClass("btn-primary").attr("aria-pressed",!1),$(this).addClass("btn-primary").removeClass("btn-secondary").attr("aria-pressed",!0),updateProfitChart(d,interval)});updateProfits(d)}
function createOptions(a){toggleBotSpan=$('\x3cspan alt\x3d"Toggle pair (hold shift to toggle all)" title\x3d"Toggle pair (hold shift to toggle all)"\x3e \x3c/span\x3e').appendTo($("#table-"+a+"-options-cell-0"));toggleBot=$('\x3cinput class\x3d"toggle-bot-button" id\x3d"toggle-bot-button-'+a+'" type\x3d"checkbox" data-index\x3d"'+a+'" data-toggle\x3d"toggle" data-onstyle\x3d"success" data-offstyle\x3d"danger" data-size\x3d"mini" '+(bots[a].enabled?"checked":"")+"\x3e").appendTo(toggleBotSpan).bootstrapToggle({on:"\u2713",
off:"\u2718"});toggleBotSpan.on("click",{toggleBot:toggleBot},function(d){toggleBot=d.data.toggleBot;checked=!toggleBot.is(":checked");a=+toggleBot.attr("data-index");d.shiftKey?(toggledIndexes=[a],$(".toggle-bot-button").get().forEach(function(d){shiftIndex=+$(d).attr("data-index");toggle=$(d).data("bs.toggle");bots[shiftIndex].enabled=checked;checked!=$(d).is(":checked")&&shiftIndex!=a&&(checked?toggle.on(!0):toggle.off(!0),toggledIndexes.push(shiftIndex))}),toggledIndexes.forEach(function(a){bot=
bots[a];exchangeName=bot.exchange.charAt(0).toUpperCase()+bot.exchange.slice(1);onLogs(a,[(checked?"Pair added to gunbot configuration.":"Pair removed from gunbot configuration.")+" You can start / stop the gunbot using the circular G button up top"])}),socket.emit("toggleBots",toggledIndexes)):(bots[a].enabled=checked,bot=bots[a],exchangeName=bot.exchange.charAt(0).toUpperCase()+bot.exchange.slice(1),onLogs(a,[(checked?"Pair added to gunbot configuration.":"Pair removed from gunbot configuration.")+
" You can start / stop the gunbot using the circular G button up top"]),$.jStorage.get("panelSettings")[bot.key]&&updatePanel(d,a,0),socket.emit("toggleBots",[a]));setTimeout(function(){mainGrid.sort(sortMainGrid(!0)).filter(filterMainGrid)},500)});settingsButton=$('\x3cbutton type\x3d"button" class\x3d"btn btn-default btn-xs btn-primary" data-index\x3d"'+a+'" data-toggle\x3d"modal" data-target\x3d"#settingsModal" alt\x3d"Pair configuration" title\x3d"Pair configuration"\x3e\x3cspan class\x3d"glyphicon glyphicon-cog"\x3e\x3c/span\x3e\x3c/button\x3e').css({"margin-left":"10px"}).appendTo($("#table-"+
a+"-options-cell-0"));settingsButton.on("click",function(d){a=+$(this).attr("data-index");bot=bots[a];socket.emit("editBotConfig",a)});panelButtonGroup=$('\x3cdiv class\x3d"btn-group" role\x3d"group" style\x3d"min-width:70px;"\x3e\x3c/div\x3e').css({"margin-top":"5px"}).appendTo($("#table-"+a+"-options-cell-1"));panelButtons=[{label:"Log",glyph:"list"},{label:"Chart",glyph:"signal"},{label:"Profit",glyph:"transfer"}];for(pi in panelButtons)panelButton=panelButtons[pi],button=$('\x3cbutton type\x3d"button" id\x3d"panel-button-'+
a+"-"+pi+'" onclick\x3d"updatePanel(event, '+a+", "+pi+')" class\x3d"btn btn-default btn-xs" alt\x3d"'+panelButton.label+' (hold shift to change all)" title\x3d"'+panelButton.label+' (hold shift to change all)"\x3e\x3cspan class\x3d"glyphicon glyphicon-'+panelButton.glyph+'"\x3e\x3c/span\x3e\x3c/button\x3e').appendTo(panelButtonGroup)}
function getDivTable(a,d,e,f){"undefined"==typeof f&&(f=[]);divTable=$('\x3cdiv class\x3d"divTable" id\x3d"table-'+a+'-table"\x3e');divBody=$('\x3cdiv class\x3d"divTableBody" id\x3d"table-'+a+'-body"\x3e').appendTo(divTable);for(r=1;r<=d;r++){divRow=$('\x3cdiv class\x3d"divTableRow" id\x3d"table-'+a+"-row-"+r+'"\x3e');for(c=1;c<=e;c++)divIndex=c+(r-1)*e-1,divValue="undefined"==typeof f[divIndex]?"":f[divIndex],divCell=$('\x3cdiv class\x3d"divTableCell" id\x3d"table-'+a+"-cell-"+divIndex+'"\x3e'+divValue+
"\x3c/div\x3e"),divCell.appendTo(divRow);divRow.appendTo(divBody)}return divTable}function updateWithFade(a,d,e){"undefined"==typeof e&&(e={});el=$("#"+a);el.html()!=d&&($.jStorage.get("gridAnimations")?function(a,d,e){a.filter(":not(:animated)").fadeTo(animationPeriod,.01,function(){0<d.toString().length&&a.html(d);a.css(e);a.fadeTo(animationPeriod,1,function(){})})}(el,d,e):(0<d.toString().length&&el.html(d),el.css(e)));return el}
function fixedDecimals(a){pre=Math.abs(Math.floor(a));return 100<=pre?0:10<=pre?2:8}function getIndexOfBot(a,d,e,f){for(i=0;i<a.length;i++)if(bot=a[i],bot.gunbotVersion==d&&bot.exchange==e&&bot.pair==f)return i;return-1}function getSetting(a,d){return $.jStorage.storageAvailable()?$.jStorage.get(a)[d]:gridSettings[a][d]}
function setSetting(a,d,e,f){"undefined"==typeof defaultSettings&&(f={});$.jStorage.storageAvailable()?(currentSettings=$.jStorage.get(a,f),currentSettings[d]=e,$.jStorage.set(a,currentSettings)):gridSettings[a][d]=e}function getBots(a){"undefined"==typeof a&&(a=!0);socket.emit("getBots");a&&0!=$.jStorage.get("authHash",!1)&&$("#loadingBotsModal").modal("show")}
function socketError(a,d){clearTimeout(socketTimeout);restartRequired||authRequired||(null!==errorStack?errorStack=null:("undefined"==typeof d&&(d="An error was encountered trying to connect to socket server!"),errorSpan=0!=a?'\x3cspan style\x3d"color:red"\x3eError: \x3cb\x3e'+a+"\x3c/b\x3e\x3c/span\x3e":"",$(".modal").modal("hide"),$("#errorSocketBody").html(d+"\x3cbr/\x3e"+errorSpan),$("#errorSocketRefresh").removeAttr("disabled"),$("#errorSocketModal").modal("show")))}
function getAsText(a,d,e){var f=new FileReader;f.readAsText(a,"UTF-8");f.onload=d;f.onerror=e}function progress(a,d){var e=a*d.width()/100;color=50>=a?"forestgreen":75>=a?"darkorange":"maroon";d.find("div").css({"background-color":color,"font-size":"11px"}).animate({width:e},animationPeriod,function(){$(this).html(a+"% ")})}
function resizeGridItems(a){"undefined"==typeof a&&(a=!0);windowWidth=$(window).width();itemSizes={600:{toolbar:{"font-size":"9px",height:"65px"},"main-grid-item":{width:600},"toolbar-cell-table":{width:"95px"}},700:{toolbar:{"font-size":"10px",height:"70px"},"main-grid-item":{width:700},"toolbar-cell-table":{width:"105px"}},800:{toolbar:{"font-size":"11px",height:"75px"},"main-grid-item":{width:800},"toolbar-cell-table":{width:"115px"}},900:{toolbar:{"font-size":"12px",height:"80px"},"main-grid-item":{width:900},
"toolbar-cell-table":{width:"125px"}}};preferredSize=["s","m","l","xl"].indexOf($.jStorage.get("gridItemSize"));columns=Math.min(Math.max(1,Math.floor(windowWidth/+Object.keys(itemSizes)[preferredSize])),bots.length);possibleItemSizes=Object.keys(itemSizes).filter(function(a){return+a*columns<=windowWidth});0==possibleItemSizes.length&&possibleItemSizes.push(+Object.keys(itemSizes)[0]);selectedSize=possibleItemSizes[possibleItemSizes.length-1];itemCss=itemSizes[selectedSize];a?($(".toolbar").animate(itemCss.toolbar,
animationPeriod),$(".toolbar-cell-table").animate(itemCss["toolbar-cell-table"],animationPeriod)):($(".toolbar").css(itemCss.toolbar),$(".toolbar-cell-table").css(itemCss["toolbar-cell-table"]));$(".main-grid-item").css(itemCss["main-grid-item"]);$(".main-grid-column-content").css({width:(itemCss["main-grid-item"].width+10)*columns+"px"});$(document.body).css({"overflow-x":"hidden"});setTimeout(function(){$(document.body).css({"overflow-x":"auto"})},1E3)}
function filterMainGrid(a){index=$(a.getElement()).attr("data-index");bot=bots[index];balances=+bot.balances[bot.pairs[1]].available+ +bot.balances[bot.pairs[1]].onOrders;return"undefined"!=typeof bot?(sortGridFilter=$.jStorage.get("sortGridFilter"),filterItem=[],searchFilter=[],$("#gridSearchInput").val().toLowerCase().split(",").forEach(function(a){a=a.trim();0<a.length&&searchFilter.push(+(-1!=bot.pair.toLowerCase().indexOf(a)||-1!=bot.exchange.toLowerCase().indexOf(a)&&4<=a.length))}),0<searchFilter.length&&
filterItem.push(Math.max.apply(null,searchFilter)),filterItem.push(+(0==sortGridFilter.recenttrade||hasRecentTrade(bot)&&1==sortGridFilter.recenttrade||!hasRecentTrade(bot)&&-1==sortGridFilter.recenttrade)),filterItem.push(+(0==sortGridFilter.enabled||bot.enabled&&1==sortGridFilter.enabled||!bot.enabled&&-1==sortGridFilter.enabled)),filterItem.push(+(0==sortGridFilter.balances||.000001<balances&&1==sortGridFilter.balances||.000001>=balances&&-1==sortGridFilter.balances)),Math.min.apply(null,filterItem)):
!0}function compareBalances(a,d){return"undefined"==typeof a.balances||"undefined"==typeof d.balances||"undefined"==typeof a.balances[a.pairs[1]]||"undefined"==typeof d.balances[d.pairs[1]]?0:(.000001<+d.balances[d.pairs[1]].available+ +d.balances[d.pairs[1]].onOrders?1:0)-(.000001<+a.balances[a.pairs[1]].available+ +a.balances[a.pairs[1]].onOrders?1:0)}
function compareRecentTrades(a,d){getLatestTradeA=getLatestTrade(a);getLatestTradeB=getLatestTrade(d);return getLatestTradeA>getLatestTradeB?1:getLatestTradeB>getLatestTradeA?-1:0}function getLatestTrade(a){return 0<Object.keys(tradeHistory).length&&"undefined"!=typeof tradeHistory[a.key]?tradeHistory[a.key]&&0<tradeHistory[a.key].length?Math.round(new Date(tradeHistory[a.key][tradeHistory[a.key].length-1].date)/1E3):0:0}
function hasRecentTrade(a){recentTradeDelta=86400;return 0<Object.keys(tradeHistory).length&&"undefined"!=typeof tradeHistory[a.key]?Date.now()/1E3-recentTradeDelta<getLatestTrade(a):!0}
function sortMainGrid(a){items=a?mainGrid.getItems():$(".main-grid-item").get();botsFound=$.jStorage.get("mainGridOrdering",[]).filter(function(a){return bots.filter(function(d){return d.key===a})[0]}).length==bots.length&&$.jStorage.get("mainGridOrdering",[]).length==bots.length;customSorting=$.jStorage.get("mainGridOrdering",[]).map(function(d){return items.filter(function(e){index=$(a?e.getElement():e).attr("data-index");return"undefined"!=typeof bots[index]&&d==bots[index].key})[0]});sortingTypes=
$.jStorage.get("sortGridOrdering");sortingAscDesc=$.jStorage.get("sortGridAscDesc");autoSorting=$(".main-grid-item").get().map(function(a){return bots[$(a).attr("data-index")]}).sort(firstBy("balances"==sortingTypes[0]?compareBalances:"recenttrade"==sortingTypes[0]?compareRecentTrades:sortingTypes[0],sortingAscDesc[sortingTypes[0]]?1:-1).thenBy("balances"==sortingTypes[1]?compareBalances:"recenttrade"==sortingTypes[1]?compareRecentTrades:sortingTypes[1],sortingAscDesc[sortingTypes[1]]?1:-1).thenBy("balances"==
sortingTypes[2]?compareBalances:"recenttrade"==sortingTypes[2]?compareRecentTrades:sortingTypes[2],sortingAscDesc[sortingTypes[2]]?1:-1).thenBy("balances"==sortingTypes[3]?compareBalances:"recenttrade"==sortingTypes[3]?compareRecentTrades:sortingTypes[3],sortingAscDesc[sortingTypes[3]]?1:-1).thenBy("balances"==sortingTypes[4]?compareBalances:"recenttrade"==sortingTypes[4]?compareRecentTrades:sortingTypes[4],sortingAscDesc[sortingTypes[4]]?1:-1)).map(function(d){return items.filter(function(e){return"undefined"!=
typeof d&&(a?e.getElement():e)===$("#grid-item-index-"+d.index).get(0)})[0]});return"custom"==$.jStorage.get("sortGridType")&&botsFound?customSorting:autoSorting}
function defaultSortGrid(){$.jStorage.deleteKey("sortGridOrdering");$.jStorage.deleteKey("sortGridType");$.jStorage.deleteKey("sortGridFilter");$.jStorage.deleteKey("sortGridAscDesc");initializeStorage();$(".sort-grid-item").get().forEach(function(a){$(a).css({color:"black"})});$(".sort-filter").get().forEach(function(a){state=$.jStorage.get("sortGridFilter")[$(a).parent().attr("sort-type")];$(a).removeClass("glyphicon-remove-circle").removeClass("glyphicon-record").removeClass("glyphicon-ok-circle").addClass("glyphicon-record").attr("data-state",
state)});$(".sort-asc-dec").get().forEach(function(a){ascDesc=$.jStorage.get("sortGridAscDesc")[$(a).parent().attr("sort-type")];$(a).removeClass("glyphicon-chevron-down").removeClass("glyphicon-chevron-up").addClass(ascDesc?"glyphicon-chevron-down":"glyphicon-chevron-up")});sortGrid.sort($(".sort-grid-item").get().map(function(a){return sortGrid.getItems().filter(function(d){return d.getElement()===a})[0]}));mainGrid.sort(sortMainGrid(!0)).filter(filterMainGrid)}
function initializeGridOptions(){gridItemSize=$.jStorage.get("gridItemSize");$(".grid-size-button").get().forEach(function(a){gridItemSize==$(a).attr("data-size")&&$(a).addClass("active")});$(".grid-size-button").on("click",function(a){$(".grid-size-button").get().forEach(function(a){$(a).removeClass("active")});$.jStorage.set("gridItemSize",$(this).attr("data-size"));$(this).removeClass("active").blur();$(this).addClass("active");resizeGridItems();setTimeout(function(){mainGrid.refreshItems().layout();
setTimeout(function(){bots.forEach(function(a){1==$.jStorage.get("panelSettings")[a.key]&&"undefined"!=typeof a.chartData&&"undefined"!=typeof a.chartData[chartPeriods[a.key]]?updateCandleChart(a.index,a.chartData[$.jStorage.get("chartPeriods")[a.key]]):2==$.jStorage.get("panelSettings")[a.key]&&"undefined"!=typeof a.profits&&updateProfitChart(a.index,$.jStorage.get("profitIntervals")[a.key])})},animationPeriod+150)},animationPeriod+150)})}
function showGuiConfigEdit(){$("#enable2FAH4").html(twoFactorEnabled?"Disable 2FA":"Enable 2FA");enable2FAToggle=$("#enable2FAToggle");enable2FAToggle.html(twoFactorEnabled?"Disable":"Enable");enable2FAToggle.removeClass("btn-primary").removeClass("btn-danger").addClass(twoFactorEnabled?"btn-danger":"btn-primary");enable2FAToggle.off();if(twoFactorEnabled)restartRequired=!0,enable2FAToggle.on("click",function(){socket.emit("disable2FA")});else enable2FAToggle.on("click",function(){socket.emit("request2FA")});
$("#guiOptionsModal").modal("show")}function isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints}function getFieldsFromTable(a){return a.split("\u2502").filter(function(a){return 0<a.length}).map(function(a){return a.trim()})}jsonEditorTypes=[{id:"string",label:"String",glyph:"a-Z"},{id:"number",label:"Number",glyph:"0-9"},{id:"boolean",label:"Boolean",glyph:"Y/N"}];jsonEditorNonEditables="STOP_LIMIT BUY_ENABLED MIN_VOLUME_TO_SELL VERBOSE EMA1 EMA2 PP_BUY PP_SELL AVGMINIMUM AVGPOINTS LASTPOINTS SELLLVL BUYLVL BUYLVL1 BUYLVL2 BUYLVL3 SELLLVL1 SELLLVL2 SELLLVL3             BTC_TRADING_LIMIT PERIOD BUY_LEVEL GAIN HIGH_BB LOW_BB PANIC_SELL DOUBLE_UP debug period_storage_ticker interval_ticker_update timeout_buy timeout_sell MIN_VOLUME_TO_BUY WATCH_MODE".split(" ");
function initJsonEditorData(a){jsonData={keys:Object.keys(a),values:Object.keys(a).map(function(d){return a[d]}),types:Object.keys(a).map(function(d){return typeof a[d]}),typeValues:{},editing:[]};Object.keys(jsonData.keys).forEach(function(a){jsonData.editing.push(!1)});jsonEditorTypes.forEach(function(a){jsonData.typeValues[a.id]=[];jsonData.values.forEach(function(d,f){jsonData.typeValues[a.id].push(typeof d==a.id?jsonData.values[f]:null)})});return jsonData}
function createJsonEditor(a,d,e,f,g){columns=4;jsonEditors[d]=initJsonEditorData(f);tableId="json-editor-"+d;a.append($('\x3cform id\x3d"'+tableId+'-form"\x3e\x3c/form\x3e'));addJsonEditorFormElements(d,columns);$("#"+tableId+"-form").validator();$("#"+tableId+"-form").off("submit","**").on("submit",{options:e,submitCallback:g,editor:d},function(a){a.isDefaultPrevented()||(returnJson=jsonEditors[a.data.editor].keys.reduce(function(d,e,f){d[e]="number"==jsonEditors[a.data.editor].types[f]?+jsonEditors[a.data.editor].values[f]:
jsonEditors[a.data.editor].values[f];return d},{}),a.data.submitCallback({options:a.data.options,json:returnJson}),a.preventDefault())})}
function addJsonEditorFormElements(a,d,e){"undefined"==typeof e&&(e=!1);tableId="json-editor-"+a;rows=Math.max(jsonEditors[a].keys.length,1);containerDiv=$('\x3cdiv id\x3d"table-container-'+tableId+'"\x3e\x3c/div\x3e').css({"max-height":"300px","overflow-y":"auto","border-top":"dotted 1px #eee","padding-top":"5px"}).append(getDivTable(tableId,rows,d));$("#"+tableId+"-form").empty().append(getDivTable(tableId+"-header",1,d)).append(containerDiv);table=$("#table-"+tableId+"-table").css({"font-size":"12px"});
["Setting","Value","Type"].forEach(function(a,d){headerCell=$("#table-"+tableId+"-header-cell-"+(d+1)).css({height:"25px"});headerCell.html('\x3cdiv style\x3d"font-weight:bold;"\x3e'+a+"\x3c/div\x3e");"Setting"==a?headerCell.css({"padding-left":"5px","min-width":"175px",width:"175px"}):"Value"==a?headerCell.css({"padding-left":"5px"}):"Type"==a&&headerCell.css({"text-align":"center","min-width":"125px",width:"125px"})});addNewCell=$("#table-"+tableId+"-header-cell-0");addNewCell.css({width:"30px",
"text-align":"center","padding-top":"4px"});addImg=$('\x3cimg border\x3d0 src\x3d"images/add.png" width\x3d"16" height\x3d"16" alt\x3d"Add new setting" title\x3d"Add new setting"/\x3e').css({cursor:"pointer"}).on("click",{editor:a,columns:d},function(a){newKeys=jsonEditors[a.data.editor].keys.filter(function(a){return/^SETTING_[0-9]{1,}$/g.test(a)}).map(function(a){return+a.match(/^SETTING_([0-9]{1,})$/)[1]});newIndex=0<newKeys.length?Math.max.apply(null,newKeys)+1:jsonEditors[a.data.editor].keys.length+
1;jsonEditors[a.data.editor].keys.push("SETTING_"+newIndex);jsonEditors[a.data.editor].values.push(null);jsonEditors[a.data.editor].types.push("number");jsonEditors[a.data.editor].editing.push(!0);Object.keys(jsonEditors[a.data.editor].typeValues).forEach(function(d){jsonEditors[a.data.editor].typeValues[d].push(null)});addJsonEditorFormElements(a.data.editor,a.data.columns);setTimeout(function(a,d){tableId="json-editor-"+a;container=$("#table-container-"+tableId);valueCell=$("#table-"+tableId+"-cell-"+
(jsonEditors[a].keys.length*d-2));$($(valueCell.children()[0]).children()[0]).focus();container.scrollTop(container.prop("scrollHeight"))},0,a.data.editor,a.data.columns)}).appendTo(addNewCell);0==jsonEditors[a].keys.length&&(deleteCell=$("#table-"+tableId+"-cell-0").html(""),keyCell=$("#table-"+tableId+"-cell-1").html('\x3cdiv style\x3d"padding-left:5px; font-size:12px; color:gray"\x3en/a\x3c/div\x3e'),valueCell=$("#table-"+tableId+"-cell-2").html('\x3cdiv style\x3d"padding-left:5px; font-size:12px; color:gray"\x3en/a\x3c/div\x3e'),
typeCell=$("#table-"+tableId+"-cell-3").html('\x3cdiv style\x3d"font-size:12px; color:gray; text-align: center;"\x3en/a\x3c/div\x3e'),deleteCell.css({width:"30px","text-align":"center"}),keyCell.css({height:"35px","max-height":"35px","min-width":"175px",width:"175px"}),typeCell.css({"text-align":"center",width:"135px"}));jsonEditors[a].keys.forEach(function(a,d){row=$("#table-"+tableId+"-row-"+(d+1));e&&row.fadeOut(0)});jsonEditors[a].keys.forEach(function(f,g){e&&setTimeout(function(a){a.fadeIn(animationPeriod)},
g*animationPeriod/4,$("#table-"+tableId+"-row-"+(g+1)));deleteCell=$("#table-"+tableId+"-cell-"+(0+g*d));keyCell=$("#table-"+tableId+"-cell-"+(1+g*d));valueCell=$("#table-"+tableId+"-cell-"+(2+g*d));typeCell=$("#table-"+tableId+"-cell-"+(3+g*d));deleteCell.css({width:"30px","text-align":"center"});keyCell.css({height:"35px","max-height":"35px","min-width":"175px",width:"175px"});typeCell.css({"text-align":"center",width:"135px"});panelButtonGroup=$('\x3cdiv class\x3d"btn-group" role\x3d"group"\x3e\x3c/div\x3e').appendTo(typeCell);
jsonEditorTypes.forEach(function(e,f){button=$('\x3cbutton type\x3d"button"  id\x3d"'+tableId+"-"+g+"-"+f+'" class\x3d"btn btn-default btn-sm"\x3e\x3cspan alt\x3d"'+e.label+'" title\x3d"'+e.label+'"\x3e'+e.glyph+"\x3c/span\x3e\x3c/button\x3e");button.on("click",{index:g,panelIndex:f,editor:a,columns:d},function(a){setJsonEditorType(a.data.editor,a.data.index,a.data.panelIndex,a.data.columns);$("#"+tableId+"-form").validator("update");$("#"+tableId+"-form").validator("validate")});button.appendTo(panelButtonGroup)});
panelButtonGroup.css({margin:"0px"});setJsonEditorType(a,g,jsonEditorTypes.map(function(a){return a.id}).indexOf(jsonEditors[a].types[g]),d);setJsonEditorKeyCell(a,g,d);deleteImg=$('\x3cimg border\x3d0 src\x3d"images/delete.png" width\x3d"16" height\x3d"16" alt\x3d"Delete setting" title\x3d"Delete setting"/\x3e').css({cursor:"pointer"}).appendTo(deleteCell);if(-1!=jsonEditorNonEditables.indexOf(f)&&"edit-bot"!=a)deleteImg.css({opacity:.5,cursor:"auto"}).attr("title","").attr("alt","");else deleteImg.on("click",
{index:g,editor:a,columns:d},function(a){jsonEditors[a.data.editor].keys=jsonEditors[a.data.editor].keys.filter(function(d,e){return e!=a.data.index});jsonEditors[a.data.editor].values=jsonEditors[a.data.editor].values.filter(function(d,e){return e!=a.data.index});jsonEditors[a.data.editor].types=jsonEditors[a.data.editor].types.filter(function(d,e){return e!=a.data.index});jsonEditors[a.data.editor].editing=jsonEditors[a.data.editor].editing.filter(function(d,e){return e!=a.data.index});Object.keys(jsonEditors[a.data.editor].typeValues).forEach(function(d){jsonEditors[a.data.editor].typeValues[d]=
jsonEditors[a.data.editor].typeValues[d].filter(function(d,e){return e!=a.data.index})});addJsonEditorFormElements(a.data.editor,a.data.columns)})});$("#"+tableId+"-form").validator("update");$("#"+tableId+"-form").validator("validate")}
function setJsonEditorKeyCell(a,d,e){key=jsonEditors[a].keys[d];tableId="json-editor-"+a;keyCell=$("#table-"+tableId+"-cell-"+(1+d*e));keyCell.css({height:"35px"});-1!=jsonEditorNonEditables.indexOf(key)&&"edit-bot"!=a?keyCell.append($('\x3cdiv class\x3d"form-group"\x3e '+key+"\x3c/div\x3e")):(formGroupContainer=$('\x3cdiv class\x3d"form-group"\x3e\x3c/div\x3e'),saveInput=function(a){jsonEditors[a.data.editor].keys[a.data.index]=$(this).val();keyCode=a.keyCode||a.which;13==keyCode&&(jsonEditors[a.data.editor].editing[a.data.index]=
!1,addJsonEditorFormElements(a.data.editor,a.data.columns))},keyInput=$('\x3cinput type\x3d"text" required class\x3d"form-control input-sm" style\x3d"min-width: 100px; width: 150px;"\x3e').appendTo(formGroupContainer),keyInput.on("keyup",{index:d,editor:a,columns:e},saveInput),keyInput.on("blur",{index:d,editor:a,columns:e},saveInput),keyInput.css({display:"inline-block"}),keyInput.attr("value",key),keyCell.append(formGroupContainer))}
function setJsonEditorType(a,d,e,f){tableId="json-editor-"+a;type=["string","number","boolean"][e];typeValue=jsonEditors[a].typeValues[type][d];valueCell=$("#table-"+tableId+"-cell-"+(2+d*f));panelButton=$("#"+tableId+"-"+d+"-"+e);for(v=0;3>v;v++)$("#"+tableId+"-"+d+"-"+v).removeClass("active").blur();panelButton.addClass("active");valueCell.empty();formGroupContainer=$('\x3cdiv class\x3d"form-group"\x3e\x3c/div\x3e').appendTo(valueCell);"string"==type||"number"==type?(input=$('\x3cinput type\x3d"text" class\x3d"form-control input-sm" style\x3d"min-width: '+
("string"==type?125:75)+"px; max-width: "+("string"==type?200:150)+'px;" required\x3e'),"number"==type&&null!=typeValue&&""!=typeValue?input.val(Number(typeValue).toFixed(12).replace(/\.?0+$/,"")):input.val(typeValue),"number"==type&&input.attr("pattern","-?(0|([1-9]\\d*))(\\.\\d+)?"),saveInput=function(a){value=$(this).val();"number"==a.data.type&&isNaN(+value)||(jsonEditors[a.data.editor].values[a.data.index]=value,jsonEditors[a.data.editor].typeValues[a.data.type][a.data.index]=value)},input.on("keyup",
{index:d,editor:a,type:type},saveInput),input.on("blur",{index:d,editor:a,type:type},saveInput),input.css({display:"inline-block"}),input.appendTo(formGroupContainer)):"boolean"==type&&(checkbox=$('\x3cinput type\x3d"checkbox" '+(typeValue?" checked":"")+"\x3e"),checkbox.css({"margin-left":"5px"}),checkbox.on("click",{index:d,editor:a,type:type},function(a){checked=$(this).is(":checked");jsonEditors[a.data.editor].values[a.data.index]=checked;jsonEditors[a.data.editor].typeValues[a.data.type][a.data.index]=
checked}),checkbox.appendTo(formGroupContainer));jsonEditors[a].types[d]=type;jsonEditors[a].values[d]=jsonEditors[a].typeValues[type][d]||["","",!1][e]}
onSslConfig=function(a,d,e){$("#guiOptionsModal").modal("hide");$("#getSslConfigButton").attr("disabled",!1);sslType="none";a?enableSSL=!0:null!==e?(enableSSL=!0,sslType="undefined"==typeof e.san&&""==e.issuer.organization&&""==e.organization||"localhost"==e.issuer.commonName&&"localhost"==e.commonName?"selfsigned":"custom"):enableSSL=!1;d?($("#configureSslCancel").fadeOut(0),$("#configureSslClose").fadeOut(0),$("#configureSslCertInfo").fadeOut(0),$("#configureSslEdit").fadeOut(0),$("#configureSslIntroduction").fadeIn(0),
$("#configureSslSelectType").fadeIn(0),$("#configureSslSave").fadeIn(0)):($("#configureSslCancel").fadeIn(0),$("#configureSslClose").fadeIn(0),$("#configureSslCertInfo").fadeIn(0),$("#configureSslEdit").fadeIn(0),$("#configureSslIntroduction").fadeOut(0),$("#configureSslSelectType").fadeOut(0),$("#configureSslSave").fadeOut(0),$("#configureSslUploadKey").removeClass("btn-danger").removeClass("btn-success").addClass("btn-basic"),$("#configureSslUploadCert").removeClass("btn-danger").removeClass("btn-success").addClass("btn-basic"),
$("#configureSslGenerateCert").removeClass("btn-danger").removeClass("btn-success").addClass("btn-basic"),$("input[name\x3dconfigureSslCertificate]").prop("checked",!1),$("#configureSslCurrentTypeImg").attr("src","images/"+("none"==sslType?"ssl-red":"selfsigned"==sslType?"ssl-yellow":"ssl-green")+".png"),$("#configureSslCertInfoIssuerCountry").html(e&&0<e.issuer.country.length?e.issuer.country:"n/a"),$("#configureSslCertInfoIssuerOrganization").html(e&&0<e.issuer.organization.length?e.issuer.organization:
"n/a"),$("#configureSslCertInfoIssuerCommonName").html(e&&0<e.issuer.commonName.length?e.issuer.commonName:"n/a"),$("#configureSslCertInfoCountry").html(e&&0<e.country.length?e.country:"n/a"),$("#configureSslCertInfoOrganization").html(e&&0<e.organization.length?e.organization:"n/a"),$("#configureSslCertInfoCommonName").html(e&&0<e.commonName.length?e.commonName:"n/a"),$("#configureSslCertInfoValidFrom").html(e&&e.validity?(new Date(e.validity.start)).toLocaleDateString("en-US"):"n/a"),$("#configureSslCertInfoValidTo").html(e&&
e.validity?(new Date(e.validity.end)).toLocaleDateString("en-US"):"n/a"),$("#configureSslCertInfoSanDns").html(e&&e.san&&0<e.san.dns.length?e.san.dns.join(", "):"n/a"),$("#configureSslCertInfoSanIp").html(e&&e.san&&0<e.san.ip.length?e.san.ip.join(", "):"n/a"),$("#configureSslCertInfoAlgoKeyAlgo").html(e&&0<e.publicKeyAlgorithm.length?e.publicKeyAlgorithm:"n/a"),$("#configureSslCertInfoAlgoKeySize").html(e&&0<e.publicKeySize.length?e.publicKeySize:"n/a"),$("#configureSslCertInfoAlgoSignAlgo").html(e&&
0<e.signatureAlgorithm.length?e.signatureAlgorithm:"n/a"));$("#configureSslSave").attr("disabled",!0);$("#configureSslSave").off().on("click",function(){restartRequired=!0;socket.emit("saveSslConfig",$("input[name\x3dconfigureSslCertificate]:checked").val())});$("#configureSslTypeNone").off().change(function(){$("#configureSslUploadKey").removeClass("btn-danger").removeClass("btn-success").addClass("btn-basic");$("#configureSslUploadCert").removeClass("btn-danger").removeClass("btn-success").addClass("btn-basic");
$("#configureSslGenerateCert").removeClass("btn-danger").removeClass("btn-success").addClass("btn-basic");$("#configureSslSave").attr("disabled",!$("input[name\x3dconfigureSslCertificate]").is(":checked"))});$("#configureSslUploadKey").off().on("click",function(){$("#configureSslUploadFile").attr("data-type","key");$("#configureSslUploadFile").click();$(this).blur()});$("#configureSslUploadCert").off().on("click",function(){$("#configureSslUploadFile").attr("data-type","certificate");$("#configureSslUploadFile").click();
$(this).blur()});$("#configureSslUploadFile").off().change(function(){if(file=$("#configureSslUploadFile").prop("files")[0])handleCertificateUpload=function(a){success=!1===a;$("#configureSslUploadLabel").css({color:success?"black":"red"}).html(success?"File upload":a);"certificate"===$("#configureSslUploadFile").attr("data-type")?$("#configureSslUploadCert").removeClass("btn-basic").removeClass(success?"btn-danger":"btn-success").addClass(success?"btn-success":"btn-danger"):"key"===$("#configureSslUploadFile").attr("data-type")&&
$("#configureSslUploadKey").removeClass("btn-basic").removeClass(success?"btn-danger":"btn-success").addClass(success?"btn-success":"btn-danger");hasKeyAndCert=$("#configureSslUploadCert").hasClass("btn-success")&&$("#configureSslUploadKey").hasClass("btn-success");success&&$("#configureSslTypeSelfSigned").is(":checked")&&($("#configureSslGenerateLabel").css({color:"black"}).html("Generate certificate"),$("#configureSslGenerateCert").removeClass("btn-danger").removeClass("btn-success").addClass("btn-basic"),
$("#configureSslTypeSelfSigned").prop("checked",!1));$("#configureSslUploadFile").val("");$("#configureSslTypeCustom").prop("checked",hasKeyAndCert);$("#configureSslSave").attr("disabled",!$("input[name\x3dconfigureSslCertificate]").is(":checked"))},1E4<file.size?handleCertificateUpload("File size too large"):"pem"!=file.name.split(".")[file.name.split(".").length-1]?handleCertificateUpload("Requires .pem extension"):getAsText(file,function(a){$.ajax({type:"POST",url:"/upload/certificate",success:function(a){handleCertificateUpload(a)},
error:function(a){handleCertificateUpload("Not a valid "+$("#configureSslUploadFile").attr("data-type")+".")},async:!0,data:{fileType:$("#configureSslUploadFile").attr("data-type"),fileContents:a.target.result,hashedPassword:$.jStorage.get("authHash")},cache:!1})},function(a){"NotReadableError"==a.target.error.name&&handleCertificateUpload("Could not read file")})});$("#configureSslModal").modal("show")};
onGuiConfig=function(a,d){guiConfiguration=d;getDataByKey=function(a,d){d=d||[];return Object.keys(a).reduce(function(e,f){newKeys=d.concat([f]);"object"!=typeof a[f]||Array.isArray(a[f])?e[newKeys.join("-")]=a[f]:$.extend(e,getDataByKey(a[f],newKeys));return e},{})};Object.keys(getDataByKey(guiConfiguration)).forEach(function(d){"select"==$("#edit-config-"+d).prop("tagName").toLowerCase()?($("#edit-config-ipWhitelist").empty(),getDataByKey(guiConfiguration)[d].forEach(function(a){$("#edit-config-ipWhitelist").append($("\x3coption\x3e",
{value:a,text:a}))})):"checkbox"==$("#edit-config-"+d).attr("type")?$("#edit-config-"+d).prop("checked",getDataByKey(guiConfiguration)[d]):$("#edit-config-"+d).val(getDataByKey(guiConfiguration)[d]);$("#edit-config-"+d).attr("data-key",d);$("#edit-config-"+d).removeAttr("required");"select"==$("#edit-config-"+d).prop("tagName").toLowerCase()?$("#edit-config-"+d).prop("required",!1):"checkbox"==$("#edit-config-"+d).attr("type")?$("#edit-config-"+d).prop("required",!1):a?$("#edit-config-"+d).prop("required",
!0):0<$("#edit-config-"+d).val().length?$("#edit-config-"+d).prop("required",!0):$("#edit-config-"+d).attr("placeholder","Hidden, leave blank to skip")});$("#edit-config-ipWhitelist-add").off().on("click",function(a){newIpAddress=$("#edit-config-ipWhitelist-ipAddress").val();exists=-1!=$.map($("#edit-config-ipWhitelist option"),function(a,d){return $(a).attr("value")}).indexOf(newIpAddress);$("#edit-config-ipWhitelist").attr("disabled",!1);$("#edit-config-ipWhitelist-add").attr("disabled",!0);$("#edit-config-ipWhitelist-ipAddress").val("");
exists||$("#edit-config-ipWhitelist").append($("\x3coption\x3e",{value:newIpAddress,text:newIpAddress}))});$("#edit-config-ipWhitelist-delete").off().on("click",function(a){$("#edit-config-ipWhitelist option[value\x3d'"+$("#edit-config-ipWhitelist").val()+"']").remove();$(this).attr("disabled",!0);0==$("#edit-config-ipWhitelist option").length&&$("#edit-config-ipWhitelist").attr("disabled",!0)});0==$("#edit-config-ipWhitelist option").length&&$("#edit-config-ipWhitelist").attr("disabled",!0);$("#edit-config-ipWhitelist").off().change(function(a){$("#edit-config-ipWhitelist-delete").attr("disabled",
!1)});$("#edit-config-ipWhitelist-ipAddress").off().on("keyup",function(a){$("#edit-config-ipWhitelist-add").attr("disabled",0==$(this).val().length)});a?($("#editConfigCancel").fadeOut(0),$("#editConfigClose").fadeOut(0)):($("#editConfigCancel").fadeIn(0),$("#editConfigClose").fadeIn(0),$("#editConfigForm").validator("validate"));$("#editConfigSave").off().on("click",function(a){!0===eval($(this).attr("isInitial"))?(exchanges=Object.keys(guiConfiguration.apiKeys).filter(function(a){return"ui"!=a}),
enteredExchanges=exchanges.reduce(function(a,d){0<["key","secret"].filter(function(a){return 0<$("#edit-config-apiKeys-"+d+"-"+a).val().length}).length&&a.push(d);return a},[]),0<enteredExchanges.length?["key","secret"].forEach(function(a){exchanges.forEach(function(d){$("#edit-config-apiKeys-"+d+"-"+a).removeAttr("required")});enteredExchanges.forEach(function(d){$("#edit-config-apiKeys-"+d+"-"+a).prop("required",!0)})}):["key","secret"].forEach(function(a){exchanges.forEach(function(d){$("#edit-config-apiKeys-"+
d+"-"+a).attr("required","")})})):$(".edit-config-input").each(function(){"select"==$(this).prop("tagName").toLowerCase()?$(this).removeAttr("required"):"checkbox"==$(this).attr("type")?$(this).removeAttr("required"):-1!=["port","intervalSeconds-ticker","intervalSeconds-exchangeData","gunbotBinary"].indexOf($(this).attr("data-key"))||0<$(this).val().length?$(this).prop("required",!0):$(this).removeAttr("required")});$("#editConfigForm").submit()});$("#editConfigForm").validator().off("submit","**").on("submit",
function(a){a.isDefaultPrevented()||(restartRequired=!0,socket.emit("saveConfig",{password:$("#edit-config-password").val(),port:+$("#edit-config-port").val(),ipWhitelist:$.map($("#edit-config-ipWhitelist option"),function(a,d){return $(a).attr("value")}),apiKeys:{ui:{key:$("#edit-config-apiKeys-ui-key").val()},poloniex:{key:$("#edit-config-apiKeys-poloniex-key").val(),secret:$("#edit-config-apiKeys-poloniex-secret").val()},kraken:{key:$("#edit-config-apiKeys-kraken-key").val(),secret:$("#edit-config-apiKeys-kraken-secret").val()},
bittrex:{key:$("#edit-config-apiKeys-bittrex-key").val(),secret:$("#edit-config-apiKeys-bittrex-secret").val()},cryptopia:{key:$("#edit-config-apiKeys-cryptopia-key").val(),secret:$("#edit-config-apiKeys-cryptopia-secret").val()}},intervalSeconds:{ticker:+$("#edit-config-intervalSeconds-ticker").val(),exchangeData:+$("#edit-config-intervalSeconds-exchangeData").val()},gunbotBinary:$("#edit-config-gunbotBinary").val()}),$("#editConfigModal").off("hidden.bs.modal","**").on("hidden.bs.modal",function(){$(".edit-config-input").each(function(){$(this).val("")})}),
$("#editConfigModal").modal("hide"),a.preventDefault())});$("#editConfigSave").attr("isInitial",a);$("#editConfigModal").modal("show")};
onBots=function(a,d){0<(d||[]).length&&$("#loadingBotsModal").modal("hide");$("#editBotConfigModal").modal("hide");null==a?($("#login").hide(),oldBots=bots||[],bots=d||[],seenOpeningModal=$.jStorage.get("seenOpeningModal",!1),!1===seenOpeningModal&&0==bots.length?$("#firstTimeModal").modal("show"):($.jStorage.set("seenOpeningModal",!0),bots.forEach(function(a){"undefined"==typeof a.logQueue&&(a.logQueue=[])}),sameBots=oldBots.filter(function(a){return getIndexOfBot(bots,a.gunbotVersion,a.exchange,
a.pair)==a.index}),sameBots.length==bots.length&&oldBots.length==bots.length&&0<sameBots.length?bots.forEach(function(a){updateBalances(a.index);updateProfits(a.index)}):(oldBots.forEach(function(a){index=getIndexOfBot(bots,a.gunbotVersion,a.exchange,a.pair);-1!=index&&["profits","tickerEvent","chartData","targets"].forEach(function(d){"undefined"!=typeof a[d]&&(bots[index][d]=a[d])})}),initGrid()))):($("#errorBotsReset").attr("disabled",!0),setTimeout(function(){$("#errorBotsReset").attr("disabled",
!1)},5E3),stopClient(),$("#errorBotsBody").html('An error was encountered trying the fetch your bots:\x3cbr/\x3e\x3cspan style\x3d"color:red"\x3e'+a+"\x3c/span\x3e"),$("#errorBotsModal").modal("show"))};
onLogs=function(a,d){gridInitialized&&(-1==a?(startSignals=bots.reduce(function(a,f){_startSignals=d.filter(function(a){return 0<["cryptopia"==f.exchange?f.pair.replace("/","_"):f.pair].filter(function(d){startSignalRegExp=new RegExp(d,"gi");return startSignalRegExp.test(a)}).length});0<_startSignals.length&&(a[d.indexOf(_startSignals[0])]=f.index);return a},{}),d.forEach(function(a,f){"undefined"!=typeof startSignals[f]&&(currentLogIndex=startSignals[f]);-1!=currentLogIndex?75<d.length||!window_focus?
parseLogs(currentLogIndex,[a],!1):bots[currentLogIndex].logQueue.push(a):bots.forEach(function(e){e.enabled&&(100<d.length||!window_focus?parseLogs(e.index,[a],!1):bots[e.index].logQueue.push(a))})})):"undefined"!=typeof bots[a]&&(75<d.length||!window_focus?parseLogs(a,d,!1):Array.prototype.push.apply(bots[a].logQueue,d)))};
onGuiLogs=function(a){$("#getGuiLogsButton").removeAttr("disabled");guiLogsBody=$("#guiLogsBody");guiLogsBody.html(0==a.length?"No logs found":a.join("\r\n\x3cbr/\x3e"));guiLogsBody.scrollTop(guiLogsBody.prop("scrollHeight"));$("#guiOptionsModal").modal("hide");$("#guiLogsModal").modal("show")};onTotalBalances=function(a){totalBalances=a;updateTotalBalances()};
onCompleteBalances=function(a,d,e){totalBalances=e;updateTotalBalances();bots.filter(function(d){return d.exchange==a}).forEach(function(a){pairs=a.pairs;balances={};balances[pairs[0]]=d[pairs[0]];balances[pairs[1]]=d[pairs[1]];bots[a.index].balances=balances;updateBalances(a.index)});mainGrid&&mainGrid.sort(sortMainGrid(!0)).filter(filterMainGrid)};
onChartData=function(a,d,e){0==e.length?bots[a].gettingData=!1:(bot=bots[a],"undefined"==typeof bot.chartData&&(bot.chartData={}),bot.chartData[d]=e.map(function(a){return{date:new Date(a.d),open:a.o,high:a.h,low:a.l,close:a.c,volume:a.v}}),-1!=["bittrex","cryptopia"].indexOf(bot.exchange)&&($(".btn-chart-index-"+bot.index).addClass("btn-secondary").removeClass("btn-primary").attr("aria-pressed",!1),$(".btn-chart-index-period-"+bot.index+"-"+d).removeClass("btn-secondary").addClass("btn-primary").attr("aria-pressed",
!0)),chartPeriods=$.jStorage.get("chartPeriods"),chartPeriods[bot.key]=d,$.jStorage.set("chartPeriods",chartPeriods),bot.gettingData=!1,bots[a]=bot,updateCandleChart(bot.index,bot.chartData[d]))};onTradeHistory=function(a,d){bot=bots[a];"undefined"!=typeof bot&&!1!==d&&("undefined"==typeof tradeHistory[bot.key]&&(tradeHistory[bot.key]=[]),d.forEach(function(a){(exists=0<tradeHistory[bot.key].filter(function(d){return d.id==a.id}).length)||tradeHistory[bot.key].push(a)}),mainGrid&&mainGrid.sort(sortMainGrid(!0)).filter(filterMainGrid))};
onProfits=function(a,d){"undefined"!=typeof bots[a]&&(!1===d?(chartCell=$("#table-"+a+"-profit-cell-0"),"true"!=chartCell.attr("is-empty")&&"undefined"!=typeof chartCell.attr("is-empty")||chartCell.html('\x3cdiv\x3e\x3ch3 style\x3d"height:250px; line-height:250px; text-align:center; width:100%; color:#1e1e1e;"\x3eFailed to get trades, retrying in a moment ...\x3ch3\x3e\x3c/div\x3e')):(key=bots[a].key,bots[a].profits=d,updateProfits(a)))};
onExchangeTicker=function(a,d){tickerBots=bots.filter(function(d){return d.exchange==a});tickerBots.forEach(function(a){"undefined"!=typeof d[a.pair]&&(a.tickerEvent=d[a.pair],updateTicker(a.index))})};onPoloniexTickerEvent=function(a,d){poloBots=bots.filter(function(d){return d.pair==a&&"poloniex"==d.exchange});poloBots.forEach(function(a){bots[a.index].tickerEvent=d;updateTicker(a.index)})};var newBotStrategies;
onRequestNewBot=function(a){a.exchanges=a.exchanges.sort(firstBy("license",-1).thenBy("index").thenBy("hasPairs",-1));display=!1===$.jStorage.get("seenOpeningModal",!1)||0==bots.length?"none":"inline-block";["newBotClose","newBotCancel"].forEach(function(a){$("#"+a).css("display",display)});$("#loadingBotsModal").modal("hide");$("#firstTimeModal").modal("hide");$("#newBotButton").removeAttr("disabled");$("#newBotRefresh").removeAttr("disabled");$("#newBotConfirm").attr("disabled","disabled");modalBody=
$("#newBotBody").html("").removeAttr("style");noExchanges=a.exchanges.length;exchangeTable=getDivTable("new-bots",2,noExchanges).appendTo(modalBody);confirmCheckboxAltText="Please make a selection of bots";confirmButtonText="Please confirm your selection";$("#new-bot-pair-confirm").attr("alt",confirmCheckboxAltText).attr("title",confirmCheckboxAltText);$("#newBotConfirm").attr("alt",confirmButtonText).attr("title",confirmButtonText);a.exchanges.forEach(function(a,e){$("#table-new-bots-cell-"+e).css({"text-align":"center",
width:Math.round(100/noExchanges)+"%"});$("#table-new-bots-cell-"+e).append('\x3cimg height\x3d"43" src\x3d"images/'+a.name+'.png" border\x3d0\x3e\x3c/img\x3e\x3cbr/\x3e\x3cdiv\x3e'+a.name.charAt(0).toUpperCase()+a.name.slice(1)+"\x3c/div\x3e");pairsDiv=$('\x3cdiv\x3e\x3cdiv style\x3d"height:5px"\x3e\x26nbsp;\x3c/div\x3e\x3c/div\x3e').css({width:"100%","border-top":"1px solid #e5e5e5","border-bottom":"1px solid #e5e5e5","margin-top":"10px","padding-left":"15%","overflow-y":"auto",height:"175px","font-size":"12px"}).addClass("white-track-background").appendTo($("#table-new-bots-cell-"+
(noExchanges+e)));pairsDiv.append('\x3cdiv style\x3d"width:100%; color:gray; padding-top:5px; '+(!1===a.error?"display:none;":"")+'" id\x3d"new-bot-pair-message-'+a.name+'"\x3e'+(!1!==a.error?a.error:"")+"\x3c/div\x3e");0<e&&pairsDiv.css({"border-left":"1px solid #e5e5e5"});a.pairs.filter(function(d){return 0==bots.filter(function(e){return e.exchange==a.name&&e.pair==d}).length}).forEach(function(d,e){id="new-bot-pair-"+a.name+"-"+d;div=$('\x3cdiv data-exchange\x3d"'+a.name+'" data-pair\x3d"'+d+
'" class\x3d"new-bot-pair-div" style\x3d"padding-top: 5px;"\x3e\x3c/div\x3e').appendTo(pairsDiv);checkbox=$('\x3cinput class\x3d"new-bot-checkbox" type\x3d"checkbox" name\x3d"gender" id\x3d"'+id+'" style\x3d"margin:0px; padding:0px;"\x3e');checkbox.off().on("click",function(a){0==$(".new-bot-checkbox:checked").get().length?$("#new-bot-pair-confirm").attr("alt",confirmCheckboxAltText).attr("title",confirmCheckboxAltText):$("#new-bot-pair-confirm").attr("alt","").attr("title","");$("#new-bot-pair-confirm").attr("disabled",
0==$(".new-bot-checkbox:checked").get().length)});div.append(checkbox);div.append('\x3clabel for\x3d"'+id+'" style\x3d"font-weight:normal; padding:0px; margin:0px;"\x3e\x26nbsp;'+d+"\x3c/label\x3e")})});optionsTable=getDivTable("new-bot-options",2,2).css({"margin-top":"15px",width:"100%"}).appendTo(modalBody);input=$('\x3cinput id\x3d"new-bot-filter-input" type\x3d"text" class\x3d"form-control input-sm" style\x3d"width: 200px;" placeholder\x3d"Example: DGB, XRP, PASC"\x3e');input.off();input.on("keyup",
function(a){$(this).trigger("filter")});input.on("filter",function(a){$("#new-bot-pair-confirm").is(":checked")||(filtered={},$(".new-bot-pair-div").get().forEach(function(a){isMatch=!1;exchange=$(a).attr("data-exchange");$("#new-bot-filter-input").val().toLowerCase().split(",").forEach(function(d){regExp=new RegExp(d.trim(),"g");0<d.trim().length&&regExp.test($(a).attr("data-pair").toLowerCase())&&(isMatch=!0)});isMatch||0==$("#new-bot-filter-input").val().length?(filter=!0,$(a).fadeIn(animationPeriod)):
(filter=!1,$(a).fadeOut(animationPeriod));"undefined"==typeof filtered[exchange]&&(filtered[exchange]=[]);filtered[exchange].push(filter)}),Object.keys(filtered).forEach(function(a){Math.max.apply(null,filtered[a])?$("#new-bot-pair-message-"+a).fadeOut(0):$("#new-bot-pair-message-"+a).html("No matches found").fadeIn(animationPeriod)}))});select=$('\x3cselect id\x3d"new-bot-strategy" class\x3d"form-control input-sm" style\x3d"width:150px;"\x3e\x3c/select\x3e');a.strategies.forEach(function(a){select.append('\x3coption value\x3d"'+
a+'"\x3e'+a+"\x3c/option\x3e")});$("#new-bot-pair-confirm").prop("checked",!1).off().on("click",function(a){$("#newBotConfirm").attr("disabled",!$(this).is(":checked"));$("#new-bot-filter-input").attr("disabled",$(this).is(":checked"));$("#new-bot-strategy").attr("disabled",$(this).is(":checked"));$("#new-bot-pair-confirm").is(":checked")?($("#newBotConfirm").attr("alt","").attr("title",""),selected={},$(".new-bot-checkbox").get().forEach(function(a){$(a).attr("disabled",!0);$(a).is(":checked")?$(a).parent().fadeIn(300):
$(a).parent().fadeOut(300);exchange=$(a).parent().attr("data-exchange");"undefined"==typeof selected[exchange]&&(selected[exchange]=[]);selected[exchange].push($(a).is(":checked"))}),Object.keys(selected).forEach(function(a){Math.max.apply(null,selected[a])?$("#new-bot-pair-message-"+a).fadeOut(0):$("#new-bot-pair-message-"+a).html("No pairs selected").fadeIn(animationPeriod)})):($("#new-bot-filter-input").trigger("filter"),$("#newBotConfirm").attr("alt",confirmButtonText).attr("title",confirmButtonText),
$(".new-bot-checkbox").get().forEach(function(a){$(a).attr("disabled",!1)}))});$("#table-new-bot-options-cell-0").css({"text-align":"right",width:"40%"}).html('\x3cdiv style\x3d"padding-right: 15px;"\x3eFilter\x3c/div\x3e');$("#table-new-bot-options-cell-1").css({width:"60%"}).html("").append(input);$("#table-new-bot-options-cell-2").css({"padding-top":"5px","text-align":"right",width:"40%"}).html('\x3cdiv style\x3d"padding-right: 15px;"\x3eStrategy\x3c/div\x3e');$("#table-new-bot-options-cell-3").css({"padding-top":"5px",
width:"60%"}).html("").append(select);modalBody.append('\x3chr style\x3d"margin-top:15px; margin-bottom:15px;"/\x3e\x3cdiv style\x3d"font-style: italic; text-align:center; width:100%; font-size: 12px; color: gray;"\x3eNot all pairs have been tested, please report any bugs you find.\x3c/div\x3e');$("#newBotConfirm").off().on("click",function(){pairs=$(".new-bot-checkbox").filter(function(){return $(this).is(":checked")}).get().map(function(a){return{strategy:$("#new-bot-strategy").val(),exchange:$(a).parent().attr("data-exchange"),
pair:$(a).parent().attr("data-pair")}});socket.emit("newBot",pairs);$("#newBotModal").modal("hide");$("#loadingBotsModal").modal("show")});$("#newBotModal").modal("show")};
function onEditBotConfig(a,d){botConfig=d.config;strategies=d.strategies;bot=bots[a];$("#editBotConfigLabel").html("Bot configuration | "+bot.pair+" | "+bot.exchange.charAt(0).toUpperCase()+bot.exchange.slice(1));$("#editBotConfigBody").empty();getDivTable("edit-bots-strategy",1,3).appendTo($("#editBotConfigBody"));$("#table-edit-bots-strategy-cell-0").css({"font-weight":"bold",width:"205px"}).append("Strategy:");select=$('\x3cselect id\x3d"editBotStrategy" class\x3d"form-control" style\x3d"width:150px; display:inline-block"\x3e\x3c/select\x3e');
Object.keys(strategies).forEach(function(a){select.append('\x3coption value\x3d"'+a+'" '+(a==botConfig.strategy?" selected":"")+"\x3e"+a+"\x3c/option\x3e")});$("#table-edit-bots-strategy-cell-1").append(select);copyButton=$('\x3cbutton class\x3d"btn btn-default"\x3eCopy to override\x3c/button\x3e');copyButton.on("click",{strategies:strategies},function(a){$(this).blur();strategy=a.data.strategies[$("#editBotStrategy").val()];jsonEditors["edit-bot"]=initJsonEditorData(strategy);addJsonEditorFormElements("edit-bot",
4,!0)});$("#table-edit-bots-strategy-cell-2").css({"text-align":"right"}).append(copyButton);$("#editBotConfigBody").append('\x3chr style\x3d"margin-top:15px; margin-bottom: 15px;"/\x3e');getDivTable("edit-bots-override",1,3).appendTo($("#editBotConfigBody"));$("#table-edit-bots-override-cell-0").css({"padding-bottom":"15px","font-weight":"bold",width:"205px"}).append("Override:");$("#table-edit-bots-override-cell-1").css({"text-align":"center",color:"gray","font-size":"11px"}).append("(settings entered below will override your strategy settings)");
removeButton=$("#configBotRemoveButton");bots[a].enabled?(removeButton.attr("disabled","disabled"),removeButton.attr("title","This bot cannot be deleted, please disable it first").attr("alt","This bot cannot be deleted, please disable it first"),removeButton.css("pointer-events","auto")):(removeButton.removeAttr("disabled"),removeButton.attr("title","").attr("alt",""));if(-1==a)removeButton.fadeOut(0);else removeButton.attr("data-index",a).fadeIn(0).off().on("click",function(a,d){_index=$(this).attr("data-index");
_bot=bots[_index];socket.emit("deleteBot",{exchange:_bot.exchange,pair:_bot.pair});$("#editBotConfigModal").modal("hide");$("#loadingBotsModal").modal("show");$(this).attr("disabled","disabled")});createJsonEditor($("#editBotConfigBody"),"edit-bot",{index:a,allowEditable:!0},botConfig.override,function(a){a.strategy=$("#editBotStrategy").val();socket.emit("saveBotConfig",a);$("#editBotConfigModal").modal("hide")});$("#editBotConfigSaveButton").off().on("click",function(a){$("#json-editor-edit-bot-form").submit()});
$("#editBotConfigModal").modal("show")}
function updateBotConfigPairs(){exchanges=$(".create-bot-config-checkbox:checked").get().map(function(a){return $(a).attr("data-exchange")});pairs=$("#createBotConfigPairs").val().split(",").map(function(a){return a.trim()}).filter(function(a){return/^[A-Z0-9]{2,5}_[A-Z0-9]{2,5}$/i.test(a)});configFiles=[];exchanges.forEach(function(a){pairs.forEach(function(d){configFiles.push(a+"-"+d+"-config.js")})});configFiles=configFiles.filter(function(a,d,e){return e.indexOf(a)==d});$("#createBotConfigPairsList").empty();
0==configFiles.length?($("#createBotConfigPairsLabel").css({"font-weight":"normal"}).html("Please select a template, at least one exchange and enter at least one pair"),$("#createBotConfigPairsList").html(configFiles.join("\x3cbr/\x3e")),$("#createBotConfigCreate").attr("disabled","disabled")):($("#createBotConfigPairsLabel").css({"font-weight":"bold"}).html("Configuration files to be created (or overwritten):"),$("#createBotConfigPairsList").html(configFiles.join("\x3cbr/\x3e")),$("#createBotConfigCreate").removeAttr("disabled"));
return configFiles}
function onNewVersion(a,d){+$.jStorage.get("latestNewTag",0)>=a||(paddedTag=a+(2==a.toString().split(".")[1].length?"0":""),$("#newVersionDownload").html('Download at: \x3ca target\x3d"_blank" href\x3d"https://github.com/sjakil/gunthy-gui/releases/tag/'+paddedTag+'"\x3ehttps://github.com/sjakil/gunthy-gui/releases/tag/'+paddedTag+"\x3c/a\x3e"),$("#newVersionOkay").off(),$("#newVersionOkay").attr("data-tag",a),$("#newVersionOkay").on("click",function(a){$.jStorage.set("latestNewTag",$("#newVersionOkay").attr("data-tag"))}),
newVersionBody=$("#newVersionBody").empty(),Object.keys(d).forEach(function(a){newVersionBody.append("\x3ch4\x3e"+a+"\x3c/h4\x3e");list=$("\x3cul\x3e\x3c/ul\x3e").appendTo(newVersionBody);d[a].forEach(function(a){list.append("\x3cli\x3e"+a+"\x3c/li")})}),$("#newVersionModal").modal("show"))}function onOpenOrders(a,d,e){gettingOpenOrders=!1;bots[d].openOrders=e;updateBalancesModal(d,!1)}
function onRequest2FA(a){$("#enable2FASave").attr("disabled",!0);$("#enable2FAQRCode").attr("src",a);$("#enable2FAVerify").off();$("#enable2FAVerify").on("click",function(a){$(this).attr("disabled",!0);socket.emit("verify2FA",$("#enable2FAToken").val())});$("#enable2FAModal").modal("show")}
function onVerify2FA(a){$("#enable2FAVerify").removeClass("btn-primary").removeClass("btn-success").removeClass("btn-danger");$("#enable2FAVerify").addClass(a?"btn-success":"btn-danger");$("#enable2FASave").attr("disabled",!a);$("#enable2FAVerify").attr("disabled",!1)}
function onMaxChartPeriod(a,d){-1!=["bittrex","cryptopia"].indexOf(bots[a].exchange)&&$.each($(".btn-chart-index-"+a),function(a,f){period=+$(f).attr("data-period");$(f).attr("disabled",period>d);title=period>d?"Not enough trades to show chart":"Hold shift to change all";$(f).attr("alt",title).attr("title",title)})}
function onSysInfo(a){progress(Math.round(1E3*a.cpu.load)/10,$("#cpuBar"));progress(Math.round(1E3*a.memory.load)/10,$("#memoryBar"));60>a.process.uptime?timerString=Math.round(a.process.uptime)+" seconds":3600>a.process.uptime?(minutes=(a.process.uptime-a.process.uptime%60)/60,timerString=minutes+" minute"+(1==minutes?"":"s")):86400>a.process.uptime?(hours=(a.process.uptime-a.process.uptime%3600)/3600,timerString=hours+" hour"+(1==hours?"":"s")):(days=(a.process.uptime-a.process.uptime%86400)/86400,
timerString=days+" day"+(1==days?"":"s"));$("#sysInfoUptime").html("Uptime: "+timerString)}
function onGunbotStrategies(a){gunbotStrategiesBody=$("#gunbotStrategiesBody").empty();0==Object.keys(a).length?(gunbotStrategiesBody.append('\x3cdiv style\x3d"text-align:center"\x3eNo strategies found\x3c/div\x3e'),$("#gunbotStrategiesSaveButton").attr("disabled",!0)):(selectedStrategy=a[Object.keys(a)[0]],editor="gunbot-strategy",getDivTable("gunbot-strategies",1,3).appendTo($("#gunbotStrategiesBody")),$("#table-gunbot-strategies-cell-0").css({"font-weight":"bold",width:"205px"}).append("Strategy:"),
$("#table-gunbot-strategies-table").css({"padding-bottom":"15px"}),select=$('\x3cselect id\x3d"gunbotStrategy" class\x3d"form-control" style\x3d"width:150px; display:inline-block"\x3e\x3c/select\x3e'),Object.keys(a).forEach(function(a){select.append('\x3coption value\x3d"'+a+'" '+(a==selectedStrategy?" selected":"")+"\x3e"+a+"\x3c/option\x3e")}),select.off().on("change",{editor:editor,strategies:a},function(a){jsonEditors[a.data.editor]=initJsonEditorData(a.data.strategies[$(this).val()]);addJsonEditorFormElements(a.data.editor,
4)}),$("#table-gunbot-strategies-cell-1").append(select),createJsonEditor(gunbotStrategiesBody,editor,{},selectedStrategy,function(a){a.strategy=$("#gunbotStrategy").val();socket.emit("saveGunbotStrategies",a);$("#gunbotStrategiesModal").modal("hide")}),$("#gunbotStrategiesSaveButton").off().on("click",function(a){$("#json-editor-"+editor+"-form").submit()}),$("#gunbotStrategiesSaveButton").attr("disabled",!1));$("#gunbotStrategiesModal").modal("show")}
function ongunbotConfig(a){gunbotConfigBody=$("#gunbotConfigBody").empty();editor="gunbot-config";createJsonEditor(gunbotConfigBody,editor,{},a,function(a){socket.emit("saveGunbotConfig",a.json);$("#gunbotConfigModal").modal("hide")});$("#gunbotConfigSaveButton").off().on("click",function(a){$("#json-editor-"+editor+"-form").submit()});$("#gunbotConfigModal").modal("show")}
parseLogs=function(a,d,e){elemScroll=$("#bot-log-"+a);scrollBottom=elemScroll.prop("scrollTop")+elemScroll.height()+100>=elemScroll.prop("scrollHeight");appendDelay=50;$("#no-bot-logs-"+a).length&&$("#no-bot-logs-"+a).fadeOut(300,function(){$(this).remove()});!1===$.jStorage.get("gridColoredLogs")&&(d=d.map(function(a){return a.replace(/<[^>]*>/g,"")}).filter(function(a){return 0<a.length}));d.forEach(function(d,g){bot=bots[a];gunbotChange=null;/Gunbot started/g.test(d)?gunbotChange=!0:/Gunbot stopped/g.test(d)&&
(gunbotChange=!1);null!==gunbotChange&&(setGunbotButton(gunbotChange),bots.forEach(function(a){}));needsUpdate=!1;/Error/i.test(d)&&(bots[a].errorCode={code:"",timestamp:Math.round(Date.now()/1E3),lastUpdate:0},needsUpdate=!0);maxPrice=d.match(/Last Ask\/Price to buy: ([0-9-+e.]*)\/([0-9-+e.]*)/);minPrice=d.match(/Last Bid\/Price to sell: ([0-9-+e.]*)\/([0-9-+e.]*)/);"undefined"==typeof bots[a].targets&&(bots[a].targets={maxPriceToBuy:0,minPriceToSell:0});minPrice&&0<minPrice.length&&(bots[a].targets.minPriceToSell=
+minPrice[2],needsUpdate=!0);maxPrice&&0<maxPrice.length&&(bots[a].targets.maxPriceToBuy=+maxPrice[2],needsUpdate=!0);needsUpdate?updateGunbot(a):"undefined"!=typeof bots[a].errorCode&&updateError(a);maxLines=Math.min(2500/Math.max(1,bots.filter(function(a){return a.enabled}).length),500);addElement=function(a,e,f,g){pausedLogs[bots[a].key]||("undefined"==typeof g&&(g=!0),children=$("#bot-log-"+a).children(),children.length>maxLines&&$(children[0]).remove(),div=$('\x3cdiv style\x3d"color: #6b6b6b;"\x3e'),
/\u250c|\u2502|\u251c|\u2514/.test(d)&&(div.css({"font-family":"Courier New"}),d=d.replace(/ /g,"\x26nbsp;")),div.html(d),div.appendTo($("#bot-log-"+a)),g&&(div.fadeOut(0),div.fadeIn(appendDelay)),e&&f.scrollTop(f.prop("scrollHeight")))};e&&$.jStorage.get("gridAnimations")?setTimeout(addElement,g*appendDelay,a,scrollBottom,elemScroll,!0):addElement(a,scrollBottom,elemScroll,!1)})};
function updatePanel(a,d,e,f){"undefined"==typeof f&&(f=!1);key=bots[d].key;currentIndex=getSetting("panelSettings",key);e!=currentIndex||"undefined"==typeof a||f||(e=-1);if(e!=currentIndex)if("undefined"!=typeof a&&a.shiftKey&&!f)for(q=0;q<Object.keys(bots).length;q++)updatePanel(a,q,e,!0);else{for(v=0;3>v;v++)$("#panel-button-"+d+"-"+v).removeClass("active").blur();$("#panel-button-"+d+"-"+e).addClass("active");(function(a,e,f,l,h){-1==f?($(".bot-tab-"+a).filter(function(){return"block"==$(this).css("display")}).animate({opacity:0},
animationPeriod,function(){$(this).css({display:"none"});mainGrid.refreshItems().layout(function(a){h.animate({opacity:1},animationPeriod)})}),$("#bot-log-settings-index-"+a).fadeOut(animationPeriod)):(0==f?$("#bot-log-settings-index-"+d).fadeIn(animationPeriod):$("#bot-log-settings-index-"+d).fadeOut(animationPeriod),-1==e?(h.css({display:"block",opacity:0}),updatePanelContent(a,f),mainGrid.refreshItems().layout(function(a){h.animate({opacity:1},animationPeriod)})):$(".bot-tab-"+a).filter(function(){return"block"==
$(this).css("display")}).animate({opacity:0},animationPeriod,function(){$(this).css({display:"none"});h.css({display:"block"});h.animate({opacity:1},animationPeriod);updatePanelContent(a,f)}))})(d,currentIndex,e,$("#bot-"+gridPanels[currentIndex]+"-"+d),$("#bot-"+gridPanels[e]+"-"+d));setSetting("panelSettings",key,e)}}
function updatePanelContent(a,d){key=bots[a].key;0==d?(elemScroll=$("#bot-log-"+a),elemScroll.scrollTop(elemScroll.prop("scrollHeight"))):1==d?(chartPeriods=$.jStorage.get("chartPeriods"),getCandleChartData(a,chartPeriods[key])):2==d&&"undefined"!=typeof bots[a].profits&&(profitIntervals=$.jStorage.get("profitIntervals"),updateProfitChart(a,profitIntervals[key]))}
function updateTarget(a,d,e,f,g,k){return 99>Math.abs(g)?(updateWithFade(d,0==f?"-":f.toFixed(fixedDecimals(f))),updateWithFade(e,'\x3cspan style\x3d"color:'+(0<g?k?"red":"green":k?"green":"red")+'"\x3e'+(0<=g?"+":"")+g.toFixed(1)+"\x3c/span\x3e"),didUpdate=!0):!1}
function updateError(a){bot=bots[a];currentTimestamp=Math.round(Date.now()/1E3);timeSinceError=currentTimestamp-bot.errorCode.timestamp;"undefined"==typeof bot.errorCode||10>currentTimestamp-bot.errorCode.lastUpdate||(color=3600>=timeSinceError?"red":86400>=timeSinceError?"orange":"rgb(175, 175, 175)",0==timeSinceError?timerString="just now":60>timeSinceError?timerString=timeSinceError+" seconds":3600>timeSinceError?(minutes=(timeSinceError-timeSinceError%60)/60,timerString=minutes+" minute"+(1==
minutes?"":"s")):86400>timeSinceError?(hours=(timeSinceError-timeSinceError%3600)/3600,timerString=hours+" hour"+(1==hours?"":"s")):(days=(timeSinceError-timeSinceError%86400)/86400,timerString=days+" day"+(1==days?"":"s")),bots[a].errorCode.lastUpdate=currentTimestamp,updateWithFade("table-"+a+"-gunbot-cell-7",timerString),updateWithFade("table-"+a+"-gunbot-cell-8",'\x3cspan style\x3d"color:'+color+'"\x3e'+bot.errorCode.code+"\x3c/span\x3e"))}
function updateGunbot(a){bot=bots[a];didUpdate=!1;gridInitialized&&"undefined"!=typeof bot&&bot.enabled&&("undefined"!=typeof bot.targets&&"undefined"!=typeof bot.tickerEvent&&(maxPriceToBuy=bot.targets.maxPriceToBuy,minPriceToSell=bot.targets.minPriceToSell,update=!1,0<maxPriceToBuy&&(maxPriceDelta=100*(+bot.tickerEvent.last/maxPriceToBuy-1),updateTarget(a,"table-"+a+"-gunbot-cell-1","table-"+a+"-gunbot-cell-2",maxPriceToBuy,maxPriceDelta,!0),update=!0),0<minPriceToSell&&(minPriceDelta=100*(+bot.tickerEvent.last/
minPriceToSell-1),updateTarget(a,"table-"+a+"-gunbot-cell-4","table-"+a+"-gunbot-cell-5",minPriceToSell,minPriceDelta,!1),update=!0),updateCandleChart(a)),"undefined"!=typeof bot.errorCode&&(updateError(a),didUpdate=!0));didUpdate&&"rgb(56, 56, 56)"==$("#table-"+a+"-toolbar-cell-2").css("color")?updateWithFade("table-"+a+"-toolbar-cell-2","",{color:"#afafaf"}):bot.enabled||"rgb(175, 175, 175)"!=$("#table-"+a+"-toolbar-cell-2").css("color")||(updateWithFade("table-"+a+"-toolbar-cell-2","",{color:"#383838"}),
updateWithFade("table-"+a+"-gunbot-cell-1","-"),updateWithFade("table-"+a+"-gunbot-cell-2","\x26nbsp;"),updateWithFade("table-"+a+"-gunbot-cell-4","-"),updateWithFade("table-"+a+"-gunbot-cell-5","\x26nbsp;"),updateWithFade("table-"+a+"-gunbot-cell-7","-"),updateWithFade("table-"+a+"-gunbot-cell-8","\x26nbsp;"),bots[a].targets={maxPriceToBuy:0,minPriceToSell:0})}
updateBalances=function(a){bot=bots[a];pairs=bot.pairs;balances=bot.balances;"undefined"!=typeof bot.balances&&0<Object.keys(bot.balances).length&&"undefined"!=typeof balances[pairs[1]]&&(shouldBeEnabled=0!=balances[pairs[1]].available||0!=balances[pairs[1]].onOrders||0!=balances[pairs[1]].btcValue,(isDisabled="rgb(56, 56, 56)"==$("#table-"+a+"-toolbar-cell-1").css("color"))&&shouldBeEnabled?updateWithFade("table-"+a+"-toolbar-cell-1","",{color:"#afafaf"}):isDisabled||shouldBeEnabled||updateWithFade("table-"+
a+"-toolbar-cell-1","",{color:"#383838"}),$("#table-"+a+"-balances-cell-1").css("text-align","right"),$("#table-"+a+"-balances-cell-3").css("text-align","right"),$("#table-"+a+"-balances-cell-5").css("text-align","right"),updateWithFade("table-"+a+"-balances-cell-1",0==balances[pairs[1]].available?"-":(+balances[pairs[1]].available).toFixed(fixedDecimals(+balances[pairs[1]].available))),updateWithFade("table-"+a+"-balances-cell-3",0==balances[pairs[1]].onOrders?"-":(+balances[pairs[1]].onOrders).toFixed(fixedDecimals(+balances[pairs[1]].onOrders))),
updateWithFade("table-"+a+"-balances-cell-5",0==balances[pairs[1]].btcValue?"-":(+balances[pairs[1]].btcValue).toFixed(fixedDecimals(+balances[pairs[1]].btcValue))))};
updateBalancesModal=function(a,d){bot=bots[a];"undefined"==typeof d&&(d=!1);"undefined"==typeof bot.openOrders&&(bots[a].openOrders=[]);d&&(openOrdersInterval=setInterval(function(a){socket.emit("getOpenOrders",a);gettingOpenOrders=!0},6E4,a),$("#balancesOrdersModal").off("hidden.bs.modal","**"),$("#balancesOrdersModal").on("hidden.bs.modal",function(){clearTimeout(openOrdersInterval)}),gettingOpenOrders=!0,socket.emit("getOpenOrders",a));balancesOrdersBalances=$("#balancesOrdersBalances").empty();
$('\x3ccenter\x3e\x3cdiv style\x3d"font-weight:bold; font-size:16px; margin-bottom:10px;"\x3eBalances\x3c/div\x3e\x3c/center\x3e').appendTo(balancesOrdersBalances);rowDiv=$('\x3cdiv class\x3d"row" style\x3d"text-align:center"\x3e\x3c/div\x3e').appendTo(balancesOrdersBalances);available=+bot.balances[bot.pairs[1]].available;$('\x3cdiv class\x3d"col-xs-6"\x3e\x3cb\x3eAvailable '+bot.pairs[1]+"\x3c/b\x3e: "+available.toFixed(fixedDecimals(available))+"\x3c/div\x3e").appendTo(rowDiv);"undefined"!=typeof bot.tickerEvent&&
(valueBtc=+available*+bot.tickerEvent.last,$('\x3cdiv class\x3d"col-xs-6"\x3e\x3cb\x3eValue in BTC\x3c/b\x3e: '+valueBtc.toFixed(fixedDecimals(valueBtc))+"\x3c/div\x3e").appendTo(rowDiv));balancesOrdersOpenOrders=$("#balancesOrdersOpenOrders").empty().append("\x3chr/\x3e");$('\x3ccenter\x3e\x3cdiv style\x3d"font-weight:bold; font-size:16px; margin-bottom:10px;"\x3eOpen orders\x3c/div\x3e\x3c/center\x3e').appendTo(balancesOrdersOpenOrders);gettingOpenOrders?$('\x3ccenter\x3e\x3cimg style\x3d"margin-top:5px;" src\x3d"images/loading.gif" width\x3d"50" height\x3d"50"\x3e\x3c/center\x3e').appendTo(balancesOrdersOpenOrders):
!1===bot.openOrders||"undefined"==typeof bot.openOrders?(centerTag=$('\x3ccenter id\x3d"get-open-orders-center-tag"\x3e\x3c/center\x3e').appendTo(balancesOrdersOpenOrders),$("\x3cdiv\x3eAn error occured fetching open orders\x3c/div\x3e").appendTo(centerTag),retryButton=$('\x3cbutton id\x3d"get-open-orders-retry" class\x3d"btn btn-primary"\x3eRetry\x3c/button\x3e').appendTo(centerTag),retryButton.attr("data-index",a),retryButton.off(),retryButton.on("click",function(){$("#get-open-orders-center-tag").empty().append('\x3cimg style\x3d"margin-top:5px;" src\x3d"images/loading.gif" width\x3d"50" height\x3d"50"\x3e');
gettingOpenOrders=!0;socket.emit("getOpenOrders",$(this).attr("data-index"))})):0==bot.openOrders.length?$("\x3ccenter\x3e\x3cdiv\x3eNo open orders found\x3c/div\x3e\x3c/center\x3e").appendTo(balancesOrdersOpenOrders):(rowDiv=$('\x3cdiv class\x3d"row" style\x3d"font-weight:bold;"\x3e\x3c/div\x3e').appendTo(balancesOrdersOpenOrders),$('\x3cdiv class\x3d"col-xs-4"\x3eDate\x3c/div\x3e').appendTo(rowDiv),$('\x3cdiv class\x3d"col-xs-1"\x3eType\x3c/div\x3e').appendTo(rowDiv),$('\x3cdiv class\x3d"col-xs-2"\x3eUnits\x3c/div\x3e').appendTo(rowDiv),
$('\x3cdiv class\x3d"col-xs-2"\x3eRate\x3c/div\x3e').appendTo(rowDiv),$('\x3cdiv class\x3d"col-xs-2"\x3eTotal\x3c/div\x3e').appendTo(rowDiv),$('\x3cdiv class\x3d"col-xs-1"\x3e\x3c/div\x3e').appendTo(rowDiv),rowDiv=$('\x3cdiv class\x3d"row"\x3e\x3c/div\x3e').appendTo(balancesOrdersOpenOrders),bot.openOrders.forEach(function(d){$('\x3cdiv class\x3d"col-xs-4"\x3e'+(new Date(d.date)).toISOString().replace(/T/," ").replace(/\..+/,"")+"\x3c/div\x3e").appendTo(rowDiv);$('\x3cdiv class\x3d"col-xs-1" style\x3d"color:'+
("buy"==d.type?"#1ccc53":"red")+'"\x3e'+d.type.charAt(0).toUpperCase()+d.type.slice(1)+"\x3c/div\x3e").appendTo(rowDiv);$('\x3cdiv class\x3d"col-xs-2"\x3e'+d.amount.toFixed(fixedDecimals(d.amount))+"\x3c/div\x3e").appendTo(rowDiv);$('\x3cdiv class\x3d"col-xs-2"\x3e'+d.price.toFixed(fixedDecimals(d.price))+"\x3c/div\x3e").appendTo(rowDiv);$('\x3cdiv class\x3d"col-xs-2"\x3e'+d.total.toFixed(fixedDecimals(d.total))+"\x3c/div\x3e").appendTo(rowDiv);$('\x3cdiv class\x3d"col-xs-1"\x3e\x3cimg border\x3d0 src\x3d"images/delete.png" width\x3d"16" height\x3d"16"/\x3e\x3c/div\x3e').attr("data-order-id",
d.id).attr("data-index",a).hover(function(){$(this).css("cursor","pointer")},function(){$(this).css("cursor","auto")}).on("click",function(a){$(this).css({opacity:.3}).off().hover(function(){$(this).css("cursor","auto")},function(){$(this).css("cursor","auto")});socket.emit("cancelOrder",{index:$(this).attr("data-index"),orderId:$(this).attr("data-order-id")})}).appendTo(rowDiv)}));$("#balancesOrdersModal").modal("show")};
updateProfits=function(a){data=bots[a].profits;$("#table-"+a+"-profit-cell-0").fadeIn(animationPeriod);gridInitialized&&"undefined"!=typeof data&&(0<Object.keys(data["1y"].balances).length?(intervals=[{index:gridProfitIntervals[0],labelDivId:"table-"+a+"-profit-loss-cell-0",valueDivId:"table-"+a+"-profit-loss-cell-1"},{index:gridProfitIntervals[1],labelDivId:"table-"+a+"-profit-loss-cell-2",valueDivId:"table-"+a+"-profit-loss-cell-3"},{index:gridProfitIntervals[2],labelDivId:"table-"+a+"-profit-loss-cell-4",
valueDivId:"table-"+a+"-profit-loss-cell-5"}],vals={},intervals.forEach(function(a){latestBalance=data[a.index].balances[Math.max.apply(null,Object.keys(data[a.index].balances).map(function(a){return parseInt(a)}))];vals[a.index]="undefined"==typeof latestBalance?0:latestBalance.currencyBalance;updateWithFade(a.valueDivId,0==vals[a.index]?"-":vals[a.index].toFixed(fixedDecimals(vals[a.index])),{color:0==vals[a.index]?"":0<vals[a.index]?"green":"red"});$("#"+a.valueDivId).css("text-align","right");
$("#"+a.labelDivId).html("\x3cb\x3e"+gridProfitIntervalLabels[a.index]+":\x3c/b\x3e")}),shouldBeEnabled=0<Math.max.apply(null,Object.keys(vals).map(function(a){return vals[a]}).map(function(a){return Math.abs(a)})),(isDisabled="rgb(56, 56, 56)"==$("#table-"+a+"-toolbar-cell-3").css("color"))&&shouldBeEnabled?updateWithFade("table-"+a+"-toolbar-cell-3","",{color:"#afafaf"}):isDisabled||shouldBeEnabled||updateWithFade("table-"+a+"-toolbar-cell-3","",{color:"#383838"}),profitIntervals=$.jStorage.get("profitIntervals"),
$("#table-"+a+"-profit-cell-1").fadeIn(animationPeriod),updateProfitChart(a,profitIntervals[key])):($("#table-"+a+"-profit-cell-0").html('\x3cdiv\x3e\x3ch3 style\x3d"height:250px; line-height:250px; text-align:center; width:100%; color:#1e1e1e;"\x3eNo trades found in selected time period\x3ch3\x3e\x3c/div\x3e'),$("#table-"+a+"-profit-cell-1").fadeOut(0)))};
updateTicker=function(a){bot=bots[a];tickerEvent=bot.tickerEvent;delay=2500;"undefined"==typeof bot.tickerDate&&(bots[a].tickerDate=Date.now()-delay);gridInitialized&&"undefined"!=typeof bot&&"undefined"!=typeof tickerEvent&&(delayDiff=Date.now()-bot.tickerDate,bot.nextTickerEvent=tickerEvent,delayDiff>=delay?doTickerUpdate(bot):(clearTimeout(bot.tickerTimeout),bot.tickerTimeout=setTimeout(doTickerUpdate,bot.tickerDate+delay-Date.now(),bot)))};
doTickerUpdate=function(a){index=a.index;tickerEvent=a.nextTickerEvent;(isDisabled="rgb(56, 56, 56)"==$("#table-"+index+"-toolbar-cell-4").css("color"))&&updateWithFade("table-"+index+"-toolbar-cell-4","",{color:"#afafaf"});$("#table-"+index+"-ticker-cell-1").css("text-align","right");$("#table-"+index+"-ticker-cell-3").css("text-align","right");$("#table-"+index+"-ticker-cell-5").css("text-align","right");updateWithFade("table-"+index+"-ticker-cell-1",(+tickerEvent.last).toFixed(fixedDecimals(tickerEvent.last)),
{color:0>+tickerEvent.percentChange?"red":"green"});updateWithFade("table-"+index+"-ticker-cell-3",(+tickerEvent["24hrHigh"]).toFixed(fixedDecimals(tickerEvent["24hrHigh"])));updateWithFade("table-"+index+"-ticker-cell-5",(+tickerEvent["24hrLow"]).toFixed(fixedDecimals(tickerEvent["24hrLow"])));panelSettings=$.jStorage.get("panelSettings","empty");chartPeriods=$.jStorage.get("chartPeriods","empty");"undefined"!=typeof a&&"undefined"!=typeof bots[index].chartData&&"undefined"!=typeof bots[index].chartData[chartPeriods[a.key]]&&
1==panelSettings[a.key]&&gridInitialized&&"poloniex"==a.exchange&&(chartData=bots[index].chartData[chartPeriods[a.key]],chartData[chartData.length-1].close=+tickerEvent.last,chartData[chartData.length-1].high=+tickerEvent.last>chartData[chartData.length-1].high?+tickerEvent.last:chartData[chartData.length-1].high,chartData[chartData.length-1].low=+tickerEvent.last<chartData[chartData.length-1].low?+tickerEvent.last:chartData[chartData.length-1].low,updateCandleChart(index,chartData));updateGunbot(index);
/(XBT|BTC)/.test(pairs[0])&&("kraken"==a.exchange?bots.filter(function(d){a.pairs[1]==d.pairs[1]&&"kraken"==d.exchange}).forEach(function(a){pairs=a.pairs;balances=a.balances;available=+balances[pairs[1]].available+ +balances[pairs[1]].onOrders;updateWithFade("table-"+index+"-balances-cell-5",0==available?"-":(available*tickerEvent.last).toFixed(fixedDecimals(available*tickerEvent.last)))}):(pairs=bots[index].pairs,balances=bots[index].balances,available=+balances[pairs[1]].available+ +balances[pairs[1]].onOrders,
updateWithFade("table-"+index+"-balances-cell-5",0==available?"-":(available*tickerEvent.last).toFixed(fixedDecimals(available*tickerEvent.last)))));bots[index].tickerDate=+Date.now()};
function updateTotalBalances(){totalBalances&&($(".total-balances").get().forEach(function(a){exchange=$(a).attr("data-exchange");"undefined"!=typeof totalBalances[exchange]&&0<totalBalances[exchange]?($(a).fadeIn(0),balance=totalBalances[exchange],$("#total-balances-"+exchange).html(0<balance?balance.toFixed(Math.min(fixedDecimals(balance),4)):"-")):$(a).fadeOut(0)}),total=Object.keys(totalBalances).reduce(function(a,d){return a+=totalBalances[d]},0),$("#total-balances-total").html(total.toFixed(Math.min(fixedDecimals(total),
4))))};
